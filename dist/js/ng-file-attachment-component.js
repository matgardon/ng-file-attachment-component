var bluesky;
(function (bluesky) {
    var core;
    (function (core) {
        var services;
        (function (services) {
            var FileAttachmentService = (function () {
                /* @ngInject */
                FileAttachmentService.$inject = ["httpWrapperService", "$log", "$timeout", "Upload", "Blob", "FileSaver", "fileAttachmentOriginEnum", "applicationOriginEnum"];
                function FileAttachmentService(httpWrapperService, $log, $timeout, Upload, Blob, //TODO MGA: typings ?
                    FileSaver, //TODO MGA: typings ?
                    fileAttachmentOriginEnum, applicationOriginEnum) {
                    this.httpWrapperService = httpWrapperService;
                    this.$log = $log;
                    this.$timeout = $timeout;
                    this.Upload = Upload;
                    this.Blob = Blob;
                    this.FileSaver = FileSaver;
                    this.fileAttachmentOriginEnum = fileAttachmentOriginEnum;
                    this.applicationOriginEnum = applicationOriginEnum;
                }
                FileAttachmentService.prototype.getAttachedFiles = function (elementId, applicationOrigin) {
                    //TODO MGA : cleaner params handling to pass to http call
                    return this.httpWrapperService.get('file-attachment/search', {
                        params: { 'elementId': elementId, 'applicationOrigin': this.applicationOriginEnum[applicationOrigin] },
                        apiEndpoint: true
                    });
                };
                FileAttachmentService.prototype.attachFile = function (elementId, applicationOrigin, fileToUpload) {
                    var _this = this;
                    if (!fileToUpload) {
                        this.$log.warn('[fileAttachmentService.attachFile] file is empty, aborting upload.');
                        return null;
                    }
                    //TODO MGA: we should rely on a stronger http-wrapper to handle upload this way
                    return this.Upload.base64DataUrl(fileToUpload).then(function (fileBase64Url) {
                        return _this.httpWrapperService.post('file-attachment/put', 
                        //TODO MGA : create model for AttachFileDto & FileUploadBaseDto
                        {
                            'ElementId': elementId,
                            'ApplicationOrigin': _this.applicationOriginEnum[applicationOrigin],
                            'FileUploadBaseDto': {
                                'FileName': fileToUpload.name,
                                'FileBase64Url': fileBase64Url.slice(fileBase64Url.indexOf('base64,') + 'base64,'.length),
                                'ContentType': fileToUpload.type
                            }
                        }, {
                            apiEndpoint: true,
                            uploadInBase64Json: true
                        });
                    });
                };
                FileAttachmentService.prototype.downloadAttachedFile = function (fileAttachment, fileOrigin) {
                    var _this = this;
                    if (!fileAttachment || !fileAttachment.Id || !fileAttachment.FileName) {
                        this.$log.error('[fileAttachment] mandatory.');
                        return null;
                    }
                    return this.httpWrapperService.getFile('file-attachment/download', {
                        params: { 'fileAttachmentId': fileAttachment.Id, 'fileOrigin': this.fileAttachmentOriginEnum[fileOrigin] },
                        apiEndpoint: true
                    }).then(function (file) {
                        //TODO MGA: extract file download as a separate service
                        //var filewithBOM = '\uFEFF'+ file; //Add BOM UTF-8 before ? for now delayed to FileSaver.saveAs() flag autoBOM parameter.
                        var blob = new Blob([file.content], { type: file.type });
                        //var blob = new Blob([file], { type: 'application/octet-stream;utf-8' });
                        //var blob = new Blob([file], { type: 'image/png;charset=windows-1252' });
                        //var blob = new Blob([file], { type: 'image/png;charset=ISO-8859-1' });
                        _this.FileSaver.saveAs(blob, file.name || fileAttachment.FileName || 'unknown.bin'); // autoBOM enabled by default
                        return;
                    });
                };
                FileAttachmentService.prototype.deleteAttachedFile = function (fileAttachmentId, fileOrigin) {
                    return this.httpWrapperService.delete('file-attachment/delete', {
                        params: { 'fileAttachmentId': fileAttachmentId, 'fileOrigin': this.fileAttachmentOriginEnum[fileOrigin] },
                        apiEndpoint: true
                    });
                };
                FileAttachmentService.prototype.editFileAttachmentComment = function (fileAttachmentId, fileOrigin, updatedComment) {
                    return this.httpWrapperService.post('file-attachment/update-comment', 
                    //TODO MGA : create Dto client-side or update endpoint srv-side to support part-params url + comment as payload (cleaner SOC).
                    {
                        'FileAttachmentId': fileAttachmentId,
                        'FileOrigin': this.fileAttachmentOriginEnum[fileOrigin],
                        'Comment': updatedComment
                    }, { apiEndpoint: true });
                };
                FileAttachmentService.prototype.getSupportedExtensions = function () {
                    return this.httpWrapperService.get('file-attachment/authorized-file-extensions', { apiEndpoint: true });
                };
                FileAttachmentService.prototype.getSupportedMimeTypes = function () {
                    return this.httpWrapperService.get('file-attachment/authorized-mime-types', { apiEndpoint: true });
                };
                FileAttachmentService.prototype.getCurrentUserUploadRights = function (elementId, applicationOrigin) {
                    return this.httpWrapperService.get('file-attachment/get-current-user-upload-rights', {
                        params: { 'elementId': elementId, 'applicationOrigin': this.applicationOriginEnum[applicationOrigin] },
                        apiEndpoint: true
                    })
                        .then(function (response) { return response.booleanResponse; });
                };
                return FileAttachmentService;
            }());
            services.FileAttachmentService = FileAttachmentService;
            angular.module('bluesky.core.services.fileAttachment', [
                'ng.httpWrapper',
                'ngFileUpload',
                'ngFileSaver',
                'bluesky.core.models.fileAttachmentOriginEnum',
                'bluesky.core.models.applicationOriginEnum'
            ]).service('fileAttachmentService', FileAttachmentService);
        })(services = core.services || (core.services = {}));
    })(core = bluesky.core || (bluesky.core = {}));
})(bluesky || (bluesky = {}));

//TODO MGA: very important to not use delegate here, otherwise this is badly captured. it MUST be an anonymous function.
File.prototype.getFileExtension = function () {
    return this.name.substr(this.name.lastIndexOf('.') + 1).toLowerCase();
};

var bluesky;
(function (bluesky) {
    var core;
    (function (core) {
        var models;
        (function (models) {
            /**
             * TODO MGA : decide on practice to share enums with srv etc
             */
            (function (ApplicationOriginEnum) {
                ApplicationOriginEnum[ApplicationOriginEnum["QuoteWizard"] = 0] = "QuoteWizard";
                ApplicationOriginEnum[ApplicationOriginEnum["OrderEntry"] = 1] = "OrderEntry";
                ApplicationOriginEnum[ApplicationOriginEnum["OrderTracking"] = 2] = "OrderTracking";
            })(models.ApplicationOriginEnum || (models.ApplicationOriginEnum = {}));
            var ApplicationOriginEnum = models.ApplicationOriginEnum;
            /**
             * declared as angular module to be injected at runtime inside controllers/services to use it as a dictionnary.
             * Otherwise, we are not sure the reference to this object will ve known at runtime due to order of evaluation of imports inside generated js.
             */
            angular.module('bluesky.core.models.applicationOriginEnum', [])
                .constant('applicationOriginEnum', ApplicationOriginEnum);
        })(models = core.models || (core.models = {}));
    })(core = bluesky.core || (bluesky.core = {}));
})(bluesky || (bluesky = {}));

var bluesky;
(function (bluesky) {
    var core;
    (function (core) {
        var models;
        (function (models) {
            /**
             * TODO MGA : decide on practice to share enums with srv etc
             */
            (function (FileAttachmentOriginEnum) {
                FileAttachmentOriginEnum[FileAttachmentOriginEnum["QuoteWizardFileAttachment"] = 0] = "QuoteWizardFileAttachment";
                FileAttachmentOriginEnum[FileAttachmentOriginEnum["OrderEntryCustomDetails"] = 1] = "OrderEntryCustomDetails";
                FileAttachmentOriginEnum[FileAttachmentOriginEnum["OrderEntryAudioCustomDetail"] = 2] = "OrderEntryAudioCustomDetail";
                FileAttachmentOriginEnum[FileAttachmentOriginEnum["OrderTrackingFileAttachment"] = 3] = "OrderTrackingFileAttachment";
            })(models.FileAttachmentOriginEnum || (models.FileAttachmentOriginEnum = {}));
            var FileAttachmentOriginEnum = models.FileAttachmentOriginEnum;
            /**
             * declared as angular module to be injected at runtime inside controllers/services to use it as a dictionnary.
             * Otherwise, we are not sure the reference to this object will ve known at runtime due to order of evaluation of imports inside generated js.
             */
            angular.module('bluesky.core.models.fileAttachmentOriginEnum', [])
                .constant('fileAttachmentOriginEnum', FileAttachmentOriginEnum);
        })(models = core.models || (core.models = {}));
    })(core = bluesky.core || (bluesky.core = {}));
})(bluesky || (bluesky = {}));

var bluesky;
(function (bluesky) {
    var core;
    (function (core) {
        var models;
        (function (models) {
            /**
             * TODO MGA : export an interface too ?
             */
            var FileAttachment = (function () {
                function FileAttachment(
                    //srv-side properties
                    Id, FileName, Comment, UploaderInformation, CreationDate, FileOrigin, CanCurrentUserDownloadFile, CanCurrentUserDeleteFile, CanCurrentUserEditComment, 
                    //client-side properties
                    editCommentMode, updatedComment, updatedCommentErrorMessage) {
                    this.Id = Id;
                    this.FileName = FileName;
                    this.Comment = Comment;
                    this.UploaderInformation = UploaderInformation;
                    this.CreationDate = CreationDate;
                    this.FileOrigin = FileOrigin;
                    this.CanCurrentUserDownloadFile = CanCurrentUserDownloadFile;
                    this.CanCurrentUserDeleteFile = CanCurrentUserDeleteFile;
                    this.CanCurrentUserEditComment = CanCurrentUserEditComment;
                    this.editCommentMode = editCommentMode;
                    this.updatedComment = updatedComment;
                    this.updatedCommentErrorMessage = updatedCommentErrorMessage;
                }
                return FileAttachment;
            }());
            models.FileAttachment = FileAttachment;
            var UserInformation = (function () {
                function UserInformation(FirstName, LastName, DisplayName, userIdentifier, Email, PhoneNumber) {
                    this.FirstName = FirstName;
                    this.LastName = LastName;
                    this.DisplayName = DisplayName;
                    this.userIdentifier = userIdentifier;
                    this.Email = Email;
                    this.PhoneNumber = PhoneNumber;
                }
                return UserInformation;
            }());
            models.UserInformation = UserInformation;
        })(models = core.models || (core.models = {}));
    })(core = bluesky.core || (bluesky.core = {}));
})(bluesky || (bluesky = {}));

var bluesky;
(function (bluesky) {
    var core;
    (function (core) {
        var models;
        (function (models) {
            var JsonBooleanResponse = (function () {
                function JsonBooleanResponse(booleanResponse) {
                    this.booleanResponse = booleanResponse;
                }
                return JsonBooleanResponse;
            }());
            models.JsonBooleanResponse = JsonBooleanResponse;
        })(models = core.models || (core.models = {}));
    })(core = bluesky.core || (bluesky.core = {}));
})(bluesky || (bluesky = {}));

var bluesky;
(function (bluesky) {
    var core;
    (function (core) {
        var components;
        (function (components) {
            //TODO MGA: convert both constants to srv-side provided limit to stay in sync with CoreAPI limits / validators
            var MAX_FILE_SIZE = 20000000; //in bytes = 20mb
            var MAX_COMMENT_LENGTH = 128;
            var FileAttachmentComponentController = (function () {
                //#endregion
                //#region ctor
                /* @ngInject */
                FileAttachmentComponentController.$inject = ["$log", "toaster", "_", "fileAttachmentService", "fileAttachmentOriginEnum", "applicationOriginEnum"];
                function FileAttachmentComponentController($log, toaster, _, fileAttachmentService, fileAttachmentOriginEnum, applicationOriginEnum) {
                    var _this = this;
                    this.$log = $log;
                    this.toaster = toaster;
                    this._ = _;
                    this.fileAttachmentService = fileAttachmentService;
                    this.fileAttachmentOriginEnum = fileAttachmentOriginEnum;
                    this.applicationOriginEnum = applicationOriginEnum;
                    this.hasCurrentUserUploadRights = false;
                    /**
                     * TODO MGA: improve inline-form error handling & UI feedback ! not dynamic // fluid to use
                     * @param fileAttachment
                     */
                    this.onUpdatedCommentValidateInput = function (fileAttachment) {
                        if (!fileAttachment.updatedComment || fileAttachment.updatedComment.length < 1) {
                            fileAttachment.updatedCommentErrorMessage = 'comment must be non-empty';
                            return false;
                        }
                        else if (fileAttachment.updatedComment && fileAttachment.updatedComment.length >= MAX_COMMENT_LENGTH) {
                            fileAttachment.updatedCommentErrorMessage = "comment must be < " + MAX_COMMENT_LENGTH + " characters";
                            return false;
                        }
                        else {
                            fileAttachment.updatedCommentErrorMessage = null; //reset error message to flag comment as valid
                            return true;
                        }
                    };
                    /**
                     * Handler dedicated to prevent on keypress='enter' the submission of a form if this component is inside one.
                     * Instead, it pushes the new value
                     */
                    this.onCommentInputKeyPress = function ($event, fileAttachment) {
                        var keyCode = $event.keyCode || $event.which;
                        if (keyCode === 13) {
                            //prevent form submission
                            $event.preventDefault();
                            //call 
                            _this.updateFileAttachmentComment(fileAttachment);
                        }
                    };
                    if (!this.elementIdBinding) {
                        this.$log.error('parameter {elementIdBinding} is mandatory.');
                        return;
                    }
                    if (!this.applicationOriginEnum[this.originBinding]) {
                        this.$log.error('parameter {originBinding} is mandatory.');
                        return;
                    }
                    this.httpPromises = new Array();
                    // get list of attached files for current element
                    this.getAttachedFiles();
                    // get flag to know if current user has upload rights for current item
                    this.getCurrentUserUploadRights();
                    // get supported mime types for file upload, based on srv info
                    this.getSupportedExtensions();
                    this.nbOfItemsPerPage = 10;
                    this.fileInvalidMessageArray = new Array();
                }
                //#endregion
                //#region file attachment management
                //TODO MGA: handle multiple files & clean up view bindings
                FileAttachmentComponentController.prototype.onFileSelected = function (files, file, newFiles, duplicateFiles, invalidFiles, event) {
                    var _this = this;
                    if (!files && !file)
                        return;
                    this.fileInvalidMessageArray = []; //reset error array
                    if (files) {
                        this.selectedFiles = files;
                    }
                    if (file) {
                        this.selectedFile = file;
                    }
                    if (files && files.length > 1) {
                        this.fileInvalidMessageArray.push('Cannot upload multiple files at once. Please select only one file.');
                        return;
                    }
                    //var fileExtension = file.name.substr(file.name.lastIndexOf('.') + 1);
                    var fileFormatSupported = _(this.supportedExtensions).any(function (supportedExtension) { return _this.selectedFile.getFileExtension() === supportedExtension.toLowerCase(); });
                    //var fileFormatSupported = file.type && //If file.type is null / empty, that means current OS doesn't know about the file format => delegate to server to validate if format is valid, we can't know client-side.
                    //    _(this.supportedExtensions).any((supportedMimeType) => file.type === supportedMimeType);
                    if (!fileFormatSupported)
                        this.fileInvalidMessageArray.push("Unsupported file format: '" + this.selectedFile.type + "' with extension: '" + this.selectedFile.getFileExtension() + "'");
                    if (!this.selectedFile.size)
                        this.fileInvalidMessageArray.push('Selected file is empty.');
                    else if (this.selectedFile.size >= MAX_FILE_SIZE)
                        this.fileInvalidMessageArray.push("Selected file is bigger (" + this.bytesToFormatedString(this.selectedFile.size) + ") than authorized file size: " + this.bytesToFormatedString(MAX_FILE_SIZE));
                };
                FileAttachmentComponentController.prototype.importSelectedFile = function () {
                    var _this = this;
                    if (!this.selectedFile || _(this.fileInvalidMessageArray).any())
                        return; //TODO MGA $log
                    var httpPromise = this.fileAttachmentService.attachFile(this.elementIdBinding, this.originBinding, this.selectedFile).then(function () {
                        _this.toaster.success("File (" + _this.selectedFile.name + ") successfully uploaded.");
                        _this.getAttachedFiles(); //TODO MGA : highlight new entry ?
                    }).finally(function () {
                        //clean up selected file
                        _this.clearSelectedFiles();
                    });
                    this.httpPromises.push(httpPromise);
                };
                FileAttachmentComponentController.prototype.clearSelectedFiles = function () {
                    this.selectedFiles = null;
                    this.selectedFile = null;
                    this.fileInvalidMessageArray = []; // clear error messages
                    //this.fileSelectedIsValid = true;
                };
                FileAttachmentComponentController.prototype.downloadAttachedFile = function (fileAttachment) {
                    if (!fileAttachment || !fileAttachment.Id)
                        return;
                    var httpPromise = this.fileAttachmentService.downloadAttachedFile(fileAttachment, this.fileAttachmentOriginEnum[fileAttachment.FileOrigin])
                        .then(function () {
                        //TODO MGA ? or leave as is.
                    });
                    this.httpPromises.push(httpPromise);
                };
                FileAttachmentComponentController.prototype.deleteAttachedFile = function (fileAttachment) {
                    var _this = this;
                    if (!fileAttachment || !fileAttachment.Id)
                        return;
                    var httpPromise = this.fileAttachmentService.deleteAttachedFile(fileAttachment.Id, this.fileAttachmentOriginEnum[fileAttachment.FileOrigin])
                        .then(function () {
                        _this.toaster.success("File (" + fileAttachment.FileName + ") successfully deleted.");
                        _this.getAttachedFiles();
                    });
                    this.httpPromises.push(httpPromise);
                };
                //TODO MGA: extract to service / extension method ?
                FileAttachmentComponentController.prototype.bytesToFormatedString = function (bytes) {
                    if (!bytes)
                        return '0 Byte';
                    var referenceScale = 1000; // or 1024 for binary ref vs. SI
                    var unitArray = ['Bytes', 'Kb', 'Mb', 'Gb', 'Tb', 'Pb', 'Eb', 'Zb', 'Yb'];
                    // get level to adopt for size multiple (bytes, KB etc).
                    var unitIndex = Math.floor(Math.log(bytes) / Math.log(referenceScale));
                    // 2 decimals, and if only Os after the ',', then parseFloat will trim ending 0s.
                    return parseFloat((bytes / Math.pow(referenceScale, unitIndex)).toFixed(2)) + ' ' + unitArray[unitIndex];
                };
                //#endregion
                //#region comment management
                FileAttachmentComponentController.prototype.switchToEditCommentMode = function (fileAttachment) {
                    fileAttachment.editCommentMode = true;
                    //set updated comment field to previous comment value
                    fileAttachment.updatedComment = fileAttachment.Comment || "";
                };
                FileAttachmentComponentController.prototype.updateFileAttachmentComment = function (fileAttachment) {
                    var _this = this;
                    if (!fileAttachment || !fileAttachment.Id || !fileAttachment.updatedComment)
                        return;
                    if (!this.onUpdatedCommentValidateInput(fileAttachment))
                        return; // check validation rules are ok
                    var httpPromise = this.fileAttachmentService.editFileAttachmentComment(fileAttachment.Id, this.fileAttachmentOriginEnum[fileAttachment.FileOrigin], fileAttachment.updatedComment).then(function () {
                        _this.clearEditCommentMode(fileAttachment); //TODO MGA: useless if we reload all data from srv
                        // retrieve update list of files with updated file comment from srv : TODO MGA improve reload (costly)
                        _this.getAttachedFiles();
                        // TODO MGA : highlight updated comment ?
                    });
                    this.httpPromises.push(httpPromise);
                };
                FileAttachmentComponentController.prototype.cancelEditComment = function (fileAttachment) {
                    fileAttachment.editCommentMode = false;
                    //fileAttachment.updatedComment = ""; // TODO MGA: decide behavior ? better to keep last entry ? but then we must also keep error message
                    //fileAttachment.updatedCommentErrorMessage = null;
                };
                //#endregion
                //#endregion
                //#region private methods
                FileAttachmentComponentController.prototype.getAttachedFiles = function () {
                    var _this = this;
                    var httpPromise = this.fileAttachmentService.getAttachedFiles(this.elementIdBinding, this.originBinding).then(function (fileAttachmentList) {
                        _this.attachedFileList = fileAttachmentList;
                        _this.attachedFileListSource = fileAttachmentList; //TODO MGA : duplicate ? to prevent update to source list if collection modified ?
                    });
                    this.httpPromises.push(httpPromise);
                };
                FileAttachmentComponentController.prototype.getSupportedExtensions = function () {
                    var _this = this;
                    var httpPromise = this.fileAttachmentService.getSupportedExtensions().then(function (supportedExtensions) {
                        _this.supportedExtensions = _(supportedExtensions).uniq();
                    });
                    this.httpPromises.push(httpPromise);
                };
                FileAttachmentComponentController.prototype.clearEditCommentMode = function (fileAttachment) {
                    fileAttachment.editCommentMode = false;
                    fileAttachment.updatedComment = null;
                    fileAttachment.updatedCommentErrorMessage = null;
                };
                FileAttachmentComponentController.prototype.getCurrentUserUploadRights = function () {
                    var _this = this;
                    this.fileAttachmentService
                        .getCurrentUserUploadRights(this.elementIdBinding, this.originBinding)
                        .then(function (booleanResponse) {
                        _this.hasCurrentUserUploadRights = booleanResponse;
                    });
                };
                return FileAttachmentComponentController;
            }());
            components.FileAttachmentComponentController = FileAttachmentComponentController;
            var FileAttachmentComponent = (function () {
                function FileAttachmentComponent() {
                    this.bindings = {
                        elementIdBinding: '=',
                        originBinding: '='
                    };
                    this.controller = FileAttachmentComponentController;
                    this.controllerAs = 'vm';
                    this.templateUrl = 'component/file-attachment.tpl.html';
                }
                return FileAttachmentComponent;
            }());
            components.FileAttachmentComponent = FileAttachmentComponent;
            angular.module('bluesky.core.components.fileAttachment', [
                'cgBusy',
                'smart-table',
                'toaster',
                'file-attachment-component-tpl',
                'bluesky.core.services.fileAttachment',
                'bluesky.core.models.fileAttachmentOriginEnum',
                'bluesky.core.models.applicationOriginEnum'
            ])
                .value('cgBusyDefaults', { templateUrl: 'templates/angular-busy/angular-busy-custom.tpl.html' })
                .constant('_', window['_'])
                .constant('moment', window['moment'])
                .component('fileAttachmentComponent', new FileAttachmentComponent());
        })(components = core.components || (core.components = {}));
    })(core = bluesky.core || (bluesky.core = {}));
})(bluesky || (bluesky = {}));

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInNlcnZpY2UvZmlsZS1hdHRhY2htZW50LnNlcnZpY2UudHMiLCJzZXJ2aWNlL2ZpbGUuZXh0ZW5zaW9ucy50cyIsIm1vZGVscy9hcHBsaWNhdGlvbi1vcmlnaW4uZW51bS50cyIsIm1vZGVscy9maWxlLWF0dGFjaG1lbnQtb3JpZ2luLmVudW0udHMiLCJtb2RlbHMvZmlsZS1hdHRhY2htZW50Lm1vZGVsLnRzIiwibW9kZWxzL2pzb24tYm9vbGVhbi1yZXNwb25zZS50cyIsImNvbXBvbmVudC9maWxlLWF0dGFjaG1lbnQuY29tcG9uZW50LnRzIiwibmctZmlsZS1hdHRhY2htZW50LWNvbXBvbmVudC5qcyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxJQUFVO0FBQVYsQ0FBQSxVQUFVLFNBQU87SUFBQyxJQUFBO0lBQUEsQ0FBQSxVQUFBLE1BQUk7UUFBQyxJQUFBO1FBQUEsQ0FBQSxVQUFBLFVBQVM7WUEyQjVCLElBQUEseUJBQUEsWUFBQTs7O2dCQUdJLFNBQUEsc0JBQ1ksb0JBQ0EsTUFDQSxVQUNBLFFBQ0E7b0JBQ0E7b0JBQ0EsMEJBQ0EsdUJBQTRDO29CQVA1QyxLQUFBLHFCQUFBO29CQUNBLEtBQUEsT0FBQTtvQkFDQSxLQUFBLFdBQUE7b0JBQ0EsS0FBQSxTQUFBO29CQUNBLEtBQUEsT0FBQTtvQkFDQSxLQUFBLFlBQUE7b0JBQ0EsS0FBQSwyQkFBQTtvQkFDQSxLQUFBLHdCQUFBOztnQkFLWixzQkFBQSxVQUFBLG1CQUFBLFVBQWlCLFdBQW1CLG1CQUF3Qzs7b0JBRXhFLE9BQU8sS0FBSyxtQkFBbUIsSUFBMkIsMEJBQTBCO3dCQUNoRixRQUFRLEVBQUUsYUFBYSxXQUFXLHFCQUFxQixLQUFLLHNCQUFzQjt3QkFDbEYsYUFBYTs7O2dCQUlyQixzQkFBQSxVQUFBLGFBQUEsVUFBVyxXQUFtQixtQkFBMEMsY0FBa0I7b0JBQTFGLElBQUEsUUFBQTtvQkFDSSxJQUFJLENBQUMsY0FBYzt3QkFDZixLQUFLLEtBQUssS0FBSzt3QkFDZixPQUFP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QixTQUFTLFVBQVUsT0FBTztpQkFDMUIsVUFBVSwyQkFBMkIsSUFBSTtXQTVWM0IsYUFBQSxLQUFBLGVBQUEsS0FBQSxhQUFVO09BQWYsT0FBQSxRQUFBLFNBQUEsUUFBQSxPQUFJO0dBQVosWUFBQSxVQUFPO0FDd2RqQiIsImZpbGUiOiJuZy1maWxlLWF0dGFjaG1lbnQtY29tcG9uZW50LmpzIiwic291cmNlc0NvbnRlbnQiOlsibmFtZXNwYWNlIGJsdWVza3kuY29yZS5zZXJ2aWNlcyB7XHJcblxyXG4gICAgaW1wb3J0IEZpbGVBdHRhY2htZW50ID0gYmx1ZXNreS5jb3JlLm1vZGVscy5GaWxlQXR0YWNobWVudDtcclxuICAgIGltcG9ydCBGaWxlQ29udGVudCA9IGJsdWVza3kuY29yZS5tb2RlbHMuRmlsZUNvbnRlbnQ7XHJcbiAgICBpbXBvcnQgRmlsZUF0dGFjaG1lbnRPcmlnaW5FbnVtID0gYmx1ZXNreS5jb3JlLm1vZGVscy5GaWxlQXR0YWNobWVudE9yaWdpbkVudW07XHJcbiAgICBpbXBvcnQgQXBwbGljYXRpb25PcmlnaW5FbnVtID0gYmx1ZXNreS5jb3JlLm1vZGVscy5BcHBsaWNhdGlvbk9yaWdpbkVudW07XHJcbiAgICBpbXBvcnQgSnNvbkJvb2xlYW5SZXNwb25zZSA9IGJsdWVza3kuY29yZS5tb2RlbHMuSnNvbkJvb2xlYW5SZXNwb25zZTtcclxuXHJcbiAgICBleHBvcnQgaW50ZXJmYWNlIElGaWxlQXR0YWNobWVudFNlcnZpY2Uge1xyXG5cclxuICAgICAgICBnZXRBdHRhY2hlZEZpbGVzKGVsZW1lbnRJZDogbnVtYmVyLCBhcHBsaWNhdGlvbk9yaWdpbjogQXBwbGljYXRpb25PcmlnaW5FbnVtKTogbmcuSVByb21pc2U8QXJyYXk8RmlsZUF0dGFjaG1lbnQ+PjtcclxuXHJcbiAgICAgICAgYXR0YWNoRmlsZShlbGVtZW50SWQ6IG51bWJlciwgYXBwbGljYXRpb25PcmlnaW46IEFwcGxpY2F0aW9uT3JpZ2luRW51bSwgZmlsZVRvVXBsb2FkOiBGaWxlKTogbmcuSVByb21pc2U8YW55PjtcclxuXHJcbiAgICAgICAgZG93bmxvYWRBdHRhY2hlZEZpbGUoZmlsZUF0dGFjaG1lbnQ6IEZpbGVBdHRhY2htZW50LCBmaWxlT3JpZ2luOiBGaWxlQXR0YWNobWVudE9yaWdpbkVudW0pOiBuZy5JUHJvbWlzZTx2b2lkPjtcclxuXHJcbiAgICAgICAgZGVsZXRlQXR0YWNoZWRGaWxlKGZpbGVBdHRhY2htZW50SWQ6IG51bWJlciwgZmlsZU9yaWdpbjogRmlsZUF0dGFjaG1lbnRPcmlnaW5FbnVtKTogbmcuSVByb21pc2U8dm9pZD47XHJcblxyXG4gICAgICAgIGVkaXRGaWxlQXR0YWNobWVudENvbW1lbnQoZmlsZUF0dGFjaG1lbnRJZDogbnVtYmVyLCBmaWxlT3JpZ2luOiBGaWxlQXR0YWNobWVudE9yaWdpbkVudW0sIHVwZGF0ZWRDb21tZW50OiBzdHJpbmcpOiBuZy5JUHJvbWlzZTx2b2lkPjtcclxuXHJcbiAgICAgICAgZ2V0U3VwcG9ydGVkRXh0ZW5zaW9ucygpOiBuZy5JUHJvbWlzZTxBcnJheTxzdHJpbmc+PjtcclxuXHJcbiAgICAgICAgZ2V0U3VwcG9ydGVkTWltZVR5cGVzKCk6IG5nLklQcm9taXNlPEFycmF5PHN0cmluZz4+O1xyXG5cclxuICAgICAgICBnZXRDdXJyZW50VXNlclVwbG9hZFJpZ2h0cyhlbGVtZW50SWQ6IG51bWJlciwgYXBwbGljYXRpb25PcmlnaW46IEFwcGxpY2F0aW9uT3JpZ2luRW51bSk6IG5nLklQcm9taXNlPGJvb2xlYW4+O1xyXG4gICAgfVxyXG5cclxuICAgIGV4cG9ydCBjbGFzcyBGaWxlQXR0YWNobWVudFNlcnZpY2UgaW1wbGVtZW50cyBJRmlsZUF0dGFjaG1lbnRTZXJ2aWNlIHtcclxuXHJcbiAgICAgICAgLyogQG5nSW5qZWN0ICovXHJcbiAgICAgICAgY29uc3RydWN0b3IoXHJcbiAgICAgICAgICAgIHByaXZhdGUgaHR0cFdyYXBwZXJTZXJ2aWNlOiBJSHR0cFdyYXBwZXJTZXJ2aWNlLFxyXG4gICAgICAgICAgICBwcml2YXRlICRsb2c6IG5nLklMb2dTZXJ2aWNlLFxyXG4gICAgICAgICAgICBwcml2YXRlICR0aW1lb3V0OiBuZy5JVGltZW91dFNlcnZpY2UsXHJcbiAgICAgICAgICAgIHByaXZhdGUgVXBsb2FkOiBuZy5hbmd1bGFyRmlsZVVwbG9hZC5JVXBsb2FkU2VydmljZSxcclxuICAgICAgICAgICAgcHJpdmF0ZSBCbG9iOiBhbnksIC8vVE9ETyBNR0E6IHR5cGluZ3MgP1xyXG4gICAgICAgICAgICBwcml2YXRlIEZpbGVTYXZlcjogYW55LCAvL1RPRE8gTUdBOiB0eXBpbmdzID9cclxuICAgICAgICAgICAgcHJpdmF0ZSBmaWxlQXR0YWNobWVudE9yaWdpbkVudW06IEZpbGVBdHRhY2htZW50T3JpZ2luRW51bSxcclxuICAgICAgICAgICAgcHJpdmF0ZSBhcHBsaWNhdGlvbk9yaWdpbkVudW06IEFwcGxpY2F0aW9uT3JpZ2luRW51bVxyXG4gICAgICAgICkge1xyXG5cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGdldEF0dGFjaGVkRmlsZXMoZWxlbWVudElkOiBudW1iZXIsIGFwcGxpY2F0aW9uT3JpZ2luOiBBcHBsaWNhdGlvbk9yaWdpbkVudW0pOiBuZy5JUHJvbWlzZTxBcnJheTxGaWxlQXR0YWNobWVudD4+IHtcclxuICAgICAgICAgICAgLy9UT0RPIE1HQSA6IGNsZWFuZXIgcGFyYW1zIGhhbmRsaW5nIHRvIHBhc3MgdG8gaHR0cCBjYWxsXHJcbiAgICAgICAgICAgIHJldHVybiB0aGlzLmh0dHBXcmFwcGVyU2VydmljZS5nZXQ8QXJyYXk8RmlsZUF0dGFjaG1lbnQ+PignZmlsZS1hdHRhY2htZW50L3NlYXJjaCcsIHtcclxuICAgICAgICAgICAgICAgIHBhcmFtczogeyAnZWxlbWVudElkJzogZWxlbWVudElkLCAnYXBwbGljYXRpb25PcmlnaW4nOiB0aGlzLmFwcGxpY2F0aW9uT3JpZ2luRW51bVthcHBsaWNhdGlvbk9yaWdpbl0gfSxcclxuICAgICAgICAgICAgICAgIGFwaUVuZHBvaW50OiB0cnVlXHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgYXR0YWNoRmlsZShlbGVtZW50SWQ6IG51bWJlciwgYXBwbGljYXRpb25PcmlnaW46IEFwcGxpY2F0aW9uT3JpZ2luRW51bSwgZmlsZVRvVXBsb2FkOiBGaWxlKTogbmcuSVByb21pc2U8YW55PiB7XHJcbiAgICAgICAgICAgIGlmICghZmlsZVRvVXBsb2FkKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLiRsb2cud2FybignW2ZpbGVBdHRhY2htZW50U2VydmljZS5hdHRhY2hGaWxlXSBmaWxlIGlzIGVtcHR5LCBhYm9ydGluZyB1cGxvYWQuJyk7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gbnVsbDtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgLy9UT0RPIE1HQTogd2Ugc2hvdWxkIHJlbHkgb24gYSBzdHJvbmdlciBodHRwLXdyYXBwZXIgdG8gaGFuZGxlIHVwbG9hZCB0aGlzIHdheVxyXG4gICAgICAgICAgICByZXR1cm4gdGhpcy5VcGxvYWQuYmFzZTY0RGF0YVVybChmaWxlVG9VcGxvYWQpLnRoZW4oKGZpbGVCYXNlNjRVcmwpID0+IHtcclxuICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLmh0dHBXcmFwcGVyU2VydmljZS5wb3N0PGFueT4oJ2ZpbGUtYXR0YWNobWVudC9wdXQnLFxyXG4gICAgICAgICAgICAgICAgICAgIC8vVE9ETyBNR0EgOiBjcmVhdGUgbW9kZWwgZm9yIEF0dGFjaEZpbGVEdG8gJiBGaWxlVXBsb2FkQmFzZUR0b1xyXG4gICAgICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgJ0VsZW1lbnRJZCc6IGVsZW1lbnRJZCxcclxuICAgICAgICAgICAgICAgICAgICAgICAgJ0FwcGxpY2F0aW9uT3JpZ2luJzogdGhpcy5hcHBsaWNhdGlvbk9yaWdpbkVudW1bYXBwbGljYXRpb25PcmlnaW5dLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAnRmlsZVVwbG9hZEJhc2VEdG8nOiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAnRmlsZU5hbWUnOiBmaWxlVG9VcGxvYWQubmFtZSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICdGaWxlQmFzZTY0VXJsJzogZmlsZUJhc2U2NFVybC5zbGljZShmaWxlQmFzZTY0VXJsLmluZGV4T2YoJ2Jhc2U2NCwnKSArICdiYXNlNjQsJy5sZW5ndGgpLCAvL3N0cmlwIHRoZSBkYXRhVXJpIHBhcnQgb2YgdGhlIGJhc2U2NCBlbmNvZGluZyB0byBvbmx5IGtlZXAgYmFzZTY0IHJhdyBkYXRhLlxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgJ0NvbnRlbnRUeXBlJzogZmlsZVRvVXBsb2FkLnR5cGVcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIH0sIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgYXBpRW5kcG9pbnQ6IHRydWUsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHVwbG9hZEluQmFzZTY0SnNvbjogdHJ1ZVxyXG4gICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGRvd25sb2FkQXR0YWNoZWRGaWxlKGZpbGVBdHRhY2htZW50OiBGaWxlQXR0YWNobWVudCwgZmlsZU9yaWdpbjogRmlsZUF0dGFjaG1lbnRPcmlnaW5FbnVtKTogbmcuSVByb21pc2U8dm9pZD4ge1xyXG4gICAgICAgICAgICBpZiAoIWZpbGVBdHRhY2htZW50IHx8ICFmaWxlQXR0YWNobWVudC5JZCB8fCAhZmlsZUF0dGFjaG1lbnQuRmlsZU5hbWUpIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuJGxvZy5lcnJvcignW2ZpbGVBdHRhY2htZW50XSBtYW5kYXRvcnkuJyk7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gbnVsbDtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgcmV0dXJuIHRoaXMuaHR0cFdyYXBwZXJTZXJ2aWNlLmdldEZpbGUoJ2ZpbGUtYXR0YWNobWVudC9kb3dubG9hZCcsIHtcclxuICAgICAgICAgICAgICAgIHBhcmFtczogeyAnZmlsZUF0dGFjaG1lbnRJZCc6IGZpbGVBdHRhY2htZW50LklkLCAnZmlsZU9yaWdpbic6IHRoaXMuZmlsZUF0dGFjaG1lbnRPcmlnaW5FbnVtW2ZpbGVPcmlnaW5dIH0sXHJcbiAgICAgICAgICAgICAgICBhcGlFbmRwb2ludDogdHJ1ZVxyXG4gICAgICAgICAgICB9KS50aGVuPHZvaWQ+KChmaWxlOiBGaWxlQ29udGVudCkgPT4ge1xyXG5cclxuICAgICAgICAgICAgICAgIC8vVE9ETyBNR0E6IGV4dHJhY3QgZmlsZSBkb3dubG9hZCBhcyBhIHNlcGFyYXRlIHNlcnZpY2VcclxuXHJcbiAgICAgICAgICAgICAgICAvL3ZhciBmaWxld2l0aEJPTSA9ICdcXHVGRUZGJysgZmlsZTsgLy9BZGQgQk9NIFVURi04IGJlZm9yZSA/IGZvciBub3cgZGVsYXllZCB0byBGaWxlU2F2ZXIuc2F2ZUFzKCkgZmxhZyBhdXRvQk9NIHBhcmFtZXRlci5cclxuICAgICAgICAgICAgICAgIHZhciBibG9iID0gbmV3IEJsb2IoW2ZpbGUuY29udGVudF0sIHsgdHlwZTogZmlsZS50eXBlIH0pO1xyXG4gICAgICAgICAgICAgICAgLy92YXIgYmxvYiA9IG5ldyBCbG9iKFtmaWxlXSwgeyB0eXBlOiAnYXBwbGljYXRpb24vb2N0ZXQtc3RyZWFtO3V0Zi04JyB9KTtcclxuICAgICAgICAgICAgICAgIC8vdmFyIGJsb2IgPSBuZXcgQmxvYihbZmlsZV0sIHsgdHlwZTogJ2ltYWdlL3BuZztjaGFyc2V0PXdpbmRvd3MtMTI1MicgfSk7XHJcbiAgICAgICAgICAgICAgICAvL3ZhciBibG9iID0gbmV3IEJsb2IoW2ZpbGVdLCB7IHR5cGU6ICdpbWFnZS9wbmc7Y2hhcnNldD1JU08tODg1OS0xJyB9KTtcclxuXHJcbiAgICAgICAgICAgICAgICB0aGlzLkZpbGVTYXZlci5zYXZlQXMoYmxvYiwgZmlsZS5uYW1lIHx8IGZpbGVBdHRhY2htZW50LkZpbGVOYW1lIHx8ICd1bmtub3duLmJpbicpOyAvLyBhdXRvQk9NIGVuYWJsZWQgYnkgZGVmYXVsdFxyXG5cclxuICAgICAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBkZWxldGVBdHRhY2hlZEZpbGUoZmlsZUF0dGFjaG1lbnRJZDogbnVtYmVyLCBmaWxlT3JpZ2luOiBGaWxlQXR0YWNobWVudE9yaWdpbkVudW0pOiBuZy5JUHJvbWlzZTx2b2lkPiB7XHJcbiAgICAgICAgICAgIHJldHVybiB0aGlzLmh0dHBXcmFwcGVyU2VydmljZS5kZWxldGU8dm9pZD4oJ2ZpbGUtYXR0YWNobWVudC9kZWxldGUnLCB7XHJcbiAgICAgICAgICAgICAgICBwYXJhbXM6IHsgJ2ZpbGVBdHRhY2htZW50SWQnOiBmaWxlQXR0YWNobWVudElkLCAnZmlsZU9yaWdpbic6IHRoaXMuZmlsZUF0dGFjaG1lbnRPcmlnaW5FbnVtW2ZpbGVPcmlnaW5dIH0sXHJcbiAgICAgICAgICAgICAgICBhcGlFbmRwb2ludDogdHJ1ZVxyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGVkaXRGaWxlQXR0YWNobWVudENvbW1lbnQoZmlsZUF0dGFjaG1lbnRJZDogbnVtYmVyLCBmaWxlT3JpZ2luOiBGaWxlQXR0YWNobWVudE9yaWdpbkVudW0sIHVwZGF0ZWRDb21tZW50OiBzdHJpbmcpOiBuZy5JUHJvbWlzZTx2b2lkPiB7XHJcbiAgICAgICAgICAgIHJldHVybiB0aGlzLmh0dHBXcmFwcGVyU2VydmljZS5wb3N0PHZvaWQ+KCdmaWxlLWF0dGFjaG1lbnQvdXBkYXRlLWNvbW1lbnQnLFxyXG4gICAgICAgICAgICAgICAgLy9UT0RPIE1HQSA6IGNyZWF0ZSBEdG8gY2xpZW50LXNpZGUgb3IgdXBkYXRlIGVuZHBvaW50IHNydi1zaWRlIHRvIHN1cHBvcnQgcGFydC1wYXJhbXMgdXJsICsgY29tbWVudCBhcyBwYXlsb2FkIChjbGVhbmVyIFNPQykuXHJcbiAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgJ0ZpbGVBdHRhY2htZW50SWQnOiBmaWxlQXR0YWNobWVudElkLFxyXG4gICAgICAgICAgICAgICAgICAgICdGaWxlT3JpZ2luJzogdGhpcy5maWxlQXR0YWNobWVudE9yaWdpbkVudW1bZmlsZU9yaWdpbl0sXHJcbiAgICAgICAgICAgICAgICAgICAgJ0NvbW1lbnQnOiB1cGRhdGVkQ29tbWVudFxyXG4gICAgICAgICAgICAgICAgfSwgeyBhcGlFbmRwb2ludDogdHJ1ZSB9KTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGdldFN1cHBvcnRlZEV4dGVuc2lvbnMoKTogbmcuSVByb21pc2U8QXJyYXk8c3RyaW5nPj4ge1xyXG4gICAgICAgICAgICByZXR1cm4gdGhpcy5odHRwV3JhcHBlclNlcnZpY2UuZ2V0PEFycmF5PHN0cmluZz4+KCdmaWxlLWF0dGFjaG1lbnQvYXV0aG9yaXplZC1maWxlLWV4dGVuc2lvbnMnLCB7IGFwaUVuZHBvaW50OiB0cnVlIH0pO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgZ2V0U3VwcG9ydGVkTWltZVR5cGVzKCk6IG5nLklQcm9taXNlPEFycmF5PHN0cmluZz4+IHtcclxuICAgICAgICAgICAgcmV0dXJuIHRoaXMuaHR0cFdyYXBwZXJTZXJ2aWNlLmdldDxBcnJheTxzdHJpbmc+PignZmlsZS1hdHRhY2htZW50L2F1dGhvcml6ZWQtbWltZS10eXBlcycsIHsgYXBpRW5kcG9pbnQ6IHRydWUgfSk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBnZXRDdXJyZW50VXNlclVwbG9hZFJpZ2h0cyhlbGVtZW50SWQ6IG51bWJlciwgYXBwbGljYXRpb25PcmlnaW46IEFwcGxpY2F0aW9uT3JpZ2luRW51bSk6IG5nLklQcm9taXNlPGJvb2xlYW4+IHtcclxuICAgICAgICAgICAgcmV0dXJuIHRoaXMuaHR0cFdyYXBwZXJTZXJ2aWNlLmdldDxKc29uQm9vbGVhblJlc3BvbnNlPignZmlsZS1hdHRhY2htZW50L2dldC1jdXJyZW50LXVzZXItdXBsb2FkLXJpZ2h0cycsXHJcbiAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgcGFyYW1zOiB7ICdlbGVtZW50SWQnOiBlbGVtZW50SWQsICdhcHBsaWNhdGlvbk9yaWdpbic6IHRoaXMuYXBwbGljYXRpb25PcmlnaW5FbnVtW2FwcGxpY2F0aW9uT3JpZ2luXSB9LFxyXG4gICAgICAgICAgICAgICAgICAgIGFwaUVuZHBvaW50OiB0cnVlXHJcbiAgICAgICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICAgICAgLnRoZW4oKHJlc3BvbnNlKSA9PiByZXNwb25zZS5ib29sZWFuUmVzcG9uc2UpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICB9XHJcblxyXG4gICAgYW5ndWxhci5tb2R1bGUoJ2JsdWVza3kuY29yZS5zZXJ2aWNlcy5maWxlQXR0YWNobWVudCcsIFtcclxuICAgICAgICAnbmcuaHR0cFdyYXBwZXInLFxyXG4gICAgICAgICduZ0ZpbGVVcGxvYWQnLFxyXG4gICAgICAgICduZ0ZpbGVTYXZlcicsXHJcbiAgICAgICAgJ2JsdWVza3kuY29yZS5tb2RlbHMuZmlsZUF0dGFjaG1lbnRPcmlnaW5FbnVtJyxcclxuICAgICAgICAnYmx1ZXNreS5jb3JlLm1vZGVscy5hcHBsaWNhdGlvbk9yaWdpbkVudW0nXHJcbiAgICBdKS5zZXJ2aWNlKCdmaWxlQXR0YWNobWVudFNlcnZpY2UnLCBGaWxlQXR0YWNobWVudFNlcnZpY2UpO1xyXG59IiwiLyoqXHJcbiAqIEV4dGVuZHMgdGhlIEZpbGUgbmF0aXZlIHR5cGUgd2l0aCBhIG5ldyBtZXRob2QgJ2dldEZpbGVFeHRlbnNpb24nXHJcbiAqL1xyXG5pbnRlcmZhY2UgRmlsZSB7XHJcbiAgICBnZXRGaWxlRXh0ZW5zaW9uKCk6IHN0cmluZztcclxufVxyXG5cclxuLy9UT0RPIE1HQTogdmVyeSBpbXBvcnRhbnQgdG8gbm90IHVzZSBkZWxlZ2F0ZSBoZXJlLCBvdGhlcndpc2UgdGhpcyBpcyBiYWRseSBjYXB0dXJlZC4gaXQgTVVTVCBiZSBhbiBhbm9ueW1vdXMgZnVuY3Rpb24uXHJcbkZpbGUucHJvdG90eXBlLmdldEZpbGVFeHRlbnNpb24gPSBmdW5jdGlvbiAoKSB7XHJcbiAgICByZXR1cm4gdGhpcy5uYW1lLnN1YnN0cih0aGlzLm5hbWUubGFzdEluZGV4T2YoJy4nKSArIDEpLnRvTG93ZXJDYXNlKCk7XHJcbn1cclxuIiwibmFtZXNwYWNlIGJsdWVza3kuY29yZS5tb2RlbHMge1xyXG4gICAgLyoqXHJcbiAgICAgKiBUT0RPIE1HQSA6IGRlY2lkZSBvbiBwcmFjdGljZSB0byBzaGFyZSBlbnVtcyB3aXRoIHNydiBldGNcclxuICAgICAqL1xyXG4gICAgZXhwb3J0IGVudW0gQXBwbGljYXRpb25PcmlnaW5FbnVtIHtcclxuICAgICAgICBRdW90ZVdpemFyZCxcclxuICAgICAgICBPcmRlckVudHJ5LFxyXG4gICAgICAgIE9yZGVyVHJhY2tpbmdcclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIGRlY2xhcmVkIGFzIGFuZ3VsYXIgbW9kdWxlIHRvIGJlIGluamVjdGVkIGF0IHJ1bnRpbWUgaW5zaWRlIGNvbnRyb2xsZXJzL3NlcnZpY2VzIHRvIHVzZSBpdCBhcyBhIGRpY3Rpb25uYXJ5LlxyXG4gICAgICogT3RoZXJ3aXNlLCB3ZSBhcmUgbm90IHN1cmUgdGhlIHJlZmVyZW5jZSB0byB0aGlzIG9iamVjdCB3aWxsIHZlIGtub3duIGF0IHJ1bnRpbWUgZHVlIHRvIG9yZGVyIG9mIGV2YWx1YXRpb24gb2YgaW1wb3J0cyBpbnNpZGUgZ2VuZXJhdGVkIGpzLlxyXG4gICAgICovXHJcbiAgICBhbmd1bGFyLm1vZHVsZSgnYmx1ZXNreS5jb3JlLm1vZGVscy5hcHBsaWNhdGlvbk9yaWdpbkVudW0nLCBbXSlcclxuICAgICAgICAuY29uc3RhbnQoJ2FwcGxpY2F0aW9uT3JpZ2luRW51bScsIEFwcGxpY2F0aW9uT3JpZ2luRW51bSk7XHJcbn0iLCJuYW1lc3BhY2UgYmx1ZXNreS5jb3JlLm1vZGVscyB7XHJcbiAgICAvKipcclxuICAgICAqIFRPRE8gTUdBIDogZGVjaWRlIG9uIHByYWN0aWNlIHRvIHNoYXJlIGVudW1zIHdpdGggc3J2IGV0Y1xyXG4gICAgICovXHJcbiAgICBleHBvcnQgZW51bSBGaWxlQXR0YWNobWVudE9yaWdpbkVudW0ge1xyXG4gICAgICAgIFF1b3RlV2l6YXJkRmlsZUF0dGFjaG1lbnQsXHJcbiAgICAgICAgT3JkZXJFbnRyeUN1c3RvbURldGFpbHMsXHJcbiAgICAgICAgT3JkZXJFbnRyeUF1ZGlvQ3VzdG9tRGV0YWlsLFxyXG4gICAgICAgIE9yZGVyVHJhY2tpbmdGaWxlQXR0YWNobWVudFxyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgICogZGVjbGFyZWQgYXMgYW5ndWxhciBtb2R1bGUgdG8gYmUgaW5qZWN0ZWQgYXQgcnVudGltZSBpbnNpZGUgY29udHJvbGxlcnMvc2VydmljZXMgdG8gdXNlIGl0IGFzIGEgZGljdGlvbm5hcnkuXHJcbiAgICAgKiBPdGhlcndpc2UsIHdlIGFyZSBub3Qgc3VyZSB0aGUgcmVmZXJlbmNlIHRvIHRoaXMgb2JqZWN0IHdpbGwgdmUga25vd24gYXQgcnVudGltZSBkdWUgdG8gb3JkZXIgb2YgZXZhbHVhdGlvbiBvZiBpbXBvcnRzIGluc2lkZSBnZW5lcmF0ZWQganMuXHJcbiAgICAgKi9cclxuICAgIGFuZ3VsYXIubW9kdWxlKCdibHVlc2t5LmNvcmUubW9kZWxzLmZpbGVBdHRhY2htZW50T3JpZ2luRW51bScsIFtdKVxyXG4gICAgICAgICAgIC5jb25zdGFudCgnZmlsZUF0dGFjaG1lbnRPcmlnaW5FbnVtJywgRmlsZUF0dGFjaG1lbnRPcmlnaW5FbnVtKTtcclxufSIsIm5hbWVzcGFjZSBibHVlc2t5LmNvcmUubW9kZWxzIHtcclxuXHJcbiAgICAvKipcclxuICAgICAqIFRPRE8gTUdBIDogZXhwb3J0IGFuIGludGVyZmFjZSB0b28gP1xyXG4gICAgICovXHJcbiAgICBleHBvcnQgY2xhc3MgRmlsZUF0dGFjaG1lbnQge1xyXG4gICAgICAgIGNvbnN0cnVjdG9yKFxyXG4gICAgICAgICAgICAvL3Nydi1zaWRlIHByb3BlcnRpZXNcclxuICAgICAgICAgICAgcHVibGljIElkOiBudW1iZXIsXHJcbiAgICAgICAgICAgIHB1YmxpYyBGaWxlTmFtZTogc3RyaW5nLFxyXG4gICAgICAgICAgICBwdWJsaWMgQ29tbWVudDogc3RyaW5nLFxyXG4gICAgICAgICAgICBwdWJsaWMgVXBsb2FkZXJJbmZvcm1hdGlvbjogVXNlckluZm9ybWF0aW9uLFxyXG4gICAgICAgICAgICBwdWJsaWMgQ3JlYXRpb25EYXRlOiBzdHJpbmcsXHJcbiAgICAgICAgICAgIHB1YmxpYyBGaWxlT3JpZ2luOiBzdHJpbmcsXHJcbiAgICAgICAgICAgIHB1YmxpYyBDYW5DdXJyZW50VXNlckRvd25sb2FkRmlsZTogYm9vbGVhbixcclxuICAgICAgICAgICAgcHVibGljIENhbkN1cnJlbnRVc2VyRGVsZXRlRmlsZTogYm9vbGVhbixcclxuICAgICAgICAgICAgcHVibGljIENhbkN1cnJlbnRVc2VyRWRpdENvbW1lbnQ6IGJvb2xlYW4sXHJcblxyXG4gICAgICAgICAgICAvL2NsaWVudC1zaWRlIHByb3BlcnRpZXNcclxuICAgICAgICAgICAgcHVibGljIGVkaXRDb21tZW50TW9kZTogYm9vbGVhbixcclxuICAgICAgICAgICAgcHVibGljIHVwZGF0ZWRDb21tZW50OiBzdHJpbmcsXHJcbiAgICAgICAgICAgIHB1YmxpYyB1cGRhdGVkQ29tbWVudEVycm9yTWVzc2FnZTogc3RyaW5nXHJcbiAgICAgICAgKSB7IH1cclxuICAgIH1cclxuXHJcbiAgICBleHBvcnQgY2xhc3MgVXNlckluZm9ybWF0aW9uIHtcclxuICAgICAgICBjb25zdHJ1Y3RvcihcclxuICAgICAgICAgICAgcHVibGljIEZpcnN0TmFtZTogc3RyaW5nLFxyXG4gICAgICAgICAgICBwdWJsaWMgTGFzdE5hbWU6IHN0cmluZyxcclxuICAgICAgICAgICAgcHVibGljIERpc3BsYXlOYW1lOiBzdHJpbmcsXHJcbiAgICAgICAgICAgIHB1YmxpYyB1c2VySWRlbnRpZmllcjogc3RyaW5nLFxyXG4gICAgICAgICAgICBwdWJsaWMgRW1haWw6IHN0cmluZyxcclxuICAgICAgICAgICAgcHVibGljIFBob25lTnVtYmVyOiBzdHJpbmdcclxuICAgICAgICApIHsgfVxyXG4gICAgfVxyXG59IiwibmFtZXNwYWNlIGJsdWVza3kuY29yZS5tb2RlbHMge1xyXG5cclxuICAgIGV4cG9ydCBjbGFzcyBKc29uQm9vbGVhblJlc3BvbnNlIHtcclxuICAgICAgICBjb25zdHJ1Y3RvcihwdWJsaWMgYm9vbGVhblJlc3BvbnNlOiBib29sZWFuKSB7IH1cclxuICAgIH1cclxufSIsIm5hbWVzcGFjZSBibHVlc2t5LmNvcmUuY29tcG9uZW50cyB7XHJcblxyXG4gICAgaW1wb3J0IEZpbGVBdHRhY2htZW50ID0gYmx1ZXNreS5jb3JlLm1vZGVscy5GaWxlQXR0YWNobWVudDtcclxuICAgIGltcG9ydCBGaWxlQXR0YWNobWVudE9yaWdpbkVudW0gPSBibHVlc2t5LmNvcmUubW9kZWxzLkZpbGVBdHRhY2htZW50T3JpZ2luRW51bTtcclxuICAgIGltcG9ydCBJRmlsZUF0dGFjaG1lbnRTZXJ2aWNlID0gYmx1ZXNreS5jb3JlLnNlcnZpY2VzLklGaWxlQXR0YWNobWVudFNlcnZpY2U7XHJcbiAgICBpbXBvcnQgQXBwbGljYXRpb25PcmlnaW5FbnVtID0gYmx1ZXNreS5jb3JlLm1vZGVscy5BcHBsaWNhdGlvbk9yaWdpbkVudW07XHJcblxyXG4gICAgLy9UT0RPIE1HQTogY29udmVydCBib3RoIGNvbnN0YW50cyB0byBzcnYtc2lkZSBwcm92aWRlZCBsaW1pdCB0byBzdGF5IGluIHN5bmMgd2l0aCBDb3JlQVBJIGxpbWl0cyAvIHZhbGlkYXRvcnNcclxuICAgIGNvbnN0IE1BWF9GSUxFX1NJWkUgPSAyMDAwMDAwMDsgLy9pbiBieXRlcyA9IDIwbWJcclxuICAgIGNvbnN0IE1BWF9DT01NRU5UX0xFTkdUSCA9IDEyODtcclxuXHJcbiAgICBleHBvcnQgaW50ZXJmYWNlIElGaWxlQXR0YWNobWVudENvbXBvbmVudEJpbmRpbmdzIHtcclxuICAgICAgICBlbGVtZW50SWRCaW5kaW5nPzogbnVtYmVyO1xyXG4gICAgICAgIG9yaWdpbkJpbmRpbmc/OiBBcHBsaWNhdGlvbk9yaWdpbkVudW07XHJcbiAgICB9XHJcblxyXG4gICAgZXhwb3J0IGludGVyZmFjZSBJRmlsZUF0dGFjaG1lbnRDb21wb25lbnRDb250cm9sbGVyIGV4dGVuZHMgSUZpbGVBdHRhY2htZW50Q29tcG9uZW50QmluZGluZ3Mge1xyXG4gICAgICAgIGF0dGFjaGVkRmlsZUxpc3Q6IEFycmF5PEZpbGVBdHRhY2htZW50PjtcclxuICAgICAgICBhdHRhY2hlZEZpbGVMaXN0U291cmNlOiBBcnJheTxGaWxlQXR0YWNobWVudD47XHJcblxyXG4gICAgICAgIGRvd25sb2FkQXR0YWNoZWRGaWxlKGZpbGVBdHRhY2htZW50OiBGaWxlQXR0YWNobWVudCk6IHZvaWQ7XHJcbiAgICAgICAgZGVsZXRlQXR0YWNoZWRGaWxlKGZpbGVBdHRhY2htZW50OiBGaWxlQXR0YWNobWVudCk6IHZvaWQ7XHJcblxyXG4gICAgICAgIGhhc0N1cnJlbnRVc2VyVXBsb2FkUmlnaHRzOiBib29sZWFuO1xyXG5cclxuICAgICAgICBzZWxlY3RlZEZpbGVzOiBBcnJheTxGaWxlPjtcclxuICAgICAgICBzZWxlY3RlZEZpbGU6IEZpbGU7XHJcbiAgICAgICAgZmlsZUludmFsaWRNZXNzYWdlQXJyYXk6IEFycmF5PHN0cmluZz47XHJcbiAgICAgICAgb25GaWxlU2VsZWN0ZWQ6IChmaWxlczogQXJyYXk8RmlsZT4sIGZpbGU6IEZpbGUsIG5ld0ZpbGVzOiBBcnJheTxGaWxlPiwgZHVwbGljYXRlRmlsZXM6IEFycmF5PEZpbGU+LCBpbnZhbGlkRmlsZXM6IEFycmF5PEZpbGU+LCBldmVudDogSlF1ZXJ5RXZlbnRPYmplY3QpID0+IHZvaWQ7XHJcbiAgICAgICAgaW1wb3J0U2VsZWN0ZWRGaWxlKCk6IHZvaWQ7XHJcbiAgICAgICAgY2xlYXJTZWxlY3RlZEZpbGVzKCk6IHZvaWQ7XHJcblxyXG4gICAgICAgIHN3aXRjaFRvRWRpdENvbW1lbnRNb2RlKGZpbGVBdHRhY2htZW50OiBGaWxlQXR0YWNobWVudCk6IHZvaWQ7XHJcbiAgICAgICAgLy9UT0RPIE1HQTogb25seSBKcXVlcnkgZXZlbnQgaGFzIG5lY2Vzc2FyeSBwcm9wZXJ0aWVzIHRvIGtub3cgc291cmNlIGV2ZW50LCBjaGVjayB3aHkgYW5ndWxhciB0eXBpbmdzIGRvZXNuJ3QgY29udGFpbiBuZWNlc3NhcnkgcGFyYW1zXHJcbiAgICAgICAgb25Db21tZW50SW5wdXRLZXlQcmVzczogKCRldmVudDogSlF1ZXJ5RXZlbnRPYmplY3QsIGZpbGVBdHRhY2htZW50OiBGaWxlQXR0YWNobWVudCkgPT4gdm9pZDtcclxuICAgICAgICB1cGRhdGVGaWxlQXR0YWNobWVudENvbW1lbnQoZmlsZUF0dGFjaG1lbnQ6IEZpbGVBdHRhY2htZW50KTogdm9pZDtcclxuICAgICAgICAvKipcclxuICAgICAgICAgKiBDaGVjayBuZXcgY29tbWVudCBpbnB1dCBhZ2FpbnN0IHZhbGlkYXRpb24gcnVsZXMsIHVwZGF0ZSBWTSB0byBpbmZvcm0gdGhlIHZpZXcgb2YgcG90ZW50aWFsIGVycm9ycy5cclxuICAgICAgICAgKiBAcGFyYW0gZmlsZUF0dGFjaG1lbnQgXHJcbiAgICAgICAgICogQHJldHVybnMge2Jvb2xlYW59IHRydWUgaWYgaW5wdXQgaXMgaW52YWxpZCwgb3RoZXJ3aXNlIGZhbHNlLiBcclxuICAgICAgICAgKi9cclxuICAgICAgICBvblVwZGF0ZWRDb21tZW50VmFsaWRhdGVJbnB1dChmaWxlQXR0YWNobWVudDogRmlsZUF0dGFjaG1lbnQpOiBib29sZWFuO1xyXG4gICAgICAgIGNhbmNlbEVkaXRDb21tZW50KGZpbGVBdHRhY2htZW50OiBGaWxlQXR0YWNobWVudCk6IHZvaWQ7XHJcblxyXG4gICAgICAgIGJ5dGVzVG9Gb3JtYXRlZFN0cmluZyhieXRlczogbnVtYmVyKTogc3RyaW5nO1xyXG5cclxuICAgICAgICBuYk9mSXRlbXNQZXJQYWdlOiBudW1iZXI7XHJcblxyXG4gICAgICAgIHN1cHBvcnRlZEV4dGVuc2lvbnM6IEFycmF5PHN0cmluZz47XHJcblxyXG4gICAgICAgIGh0dHBQcm9taXNlczogQXJyYXk8bmcuSVByb21pc2U8YW55Pj47XHJcbiAgICB9XHJcblxyXG4gICAgZXhwb3J0IGNsYXNzIEZpbGVBdHRhY2htZW50Q29tcG9uZW50Q29udHJvbGxlciBpbXBsZW1lbnRzIElGaWxlQXR0YWNobWVudENvbXBvbmVudENvbnRyb2xsZXIge1xyXG5cclxuICAgICAgICAvLyNyZWdpb24gYmluZGluZyBwcm9wXHJcblxyXG4gICAgICAgIGVsZW1lbnRJZEJpbmRpbmc6IG51bWJlcjtcclxuICAgICAgICBvcmlnaW5CaW5kaW5nOiBBcHBsaWNhdGlvbk9yaWdpbkVudW07XHJcblxyXG4gICAgICAgIC8vI2VuZHJlZ2lvblxyXG5cclxuICAgICAgICAvLyNyZWdpb24gdm0gcHJvcFxyXG5cclxuICAgICAgICBhdHRhY2hlZEZpbGVMaXN0OiBBcnJheTxGaWxlQXR0YWNobWVudD47XHJcbiAgICAgICAgYXR0YWNoZWRGaWxlTGlzdFNvdXJjZTogQXJyYXk8RmlsZUF0dGFjaG1lbnQ+O1xyXG4gICAgICAgIGhhc0N1cnJlbnRVc2VyVXBsb2FkUmlnaHRzID0gZmFsc2U7XHJcbiAgICAgICAgc2VsZWN0ZWRGaWxlczogQXJyYXk8RmlsZT47XHJcbiAgICAgICAgc2VsZWN0ZWRGaWxlOiBGaWxlO1xyXG4gICAgICAgIGZpbGVJbnZhbGlkTWVzc2FnZUFycmF5OiBBcnJheTxzdHJpbmc+O1xyXG4gICAgICAgIG5iT2ZJdGVtc1BlclBhZ2U6IG51bWJlcjtcclxuICAgICAgICBodHRwUHJvbWlzZXM6IEFycmF5PG5nLklQcm9taXNlPGFueT4+O1xyXG4gICAgICAgIHN1cHBvcnRlZEV4dGVuc2lvbnM6IEFycmF5PHN0cmluZz47XHJcblxyXG4gICAgICAgIC8vI2VuZHJlZ2lvblxyXG5cclxuICAgICAgICAvLyNyZWdpb24gY3RvclxyXG5cclxuICAgICAgICAvKiBAbmdJbmplY3QgKi9cclxuICAgICAgICBjb25zdHJ1Y3RvcihcclxuICAgICAgICAgICAgcHJpdmF0ZSAkbG9nOiBuZy5JTG9nU2VydmljZSxcclxuICAgICAgICAgICAgcHJpdmF0ZSB0b2FzdGVyOiBuZ3RvYXN0ZXIuSVRvYXN0ZXJTZXJ2aWNlLFxyXG4gICAgICAgICAgICBwcml2YXRlIF86IFVuZGVyc2NvcmVTdGF0aWMsXHJcbiAgICAgICAgICAgIHByaXZhdGUgZmlsZUF0dGFjaG1lbnRTZXJ2aWNlOiBJRmlsZUF0dGFjaG1lbnRTZXJ2aWNlLFxyXG4gICAgICAgICAgICBwcml2YXRlIGZpbGVBdHRhY2htZW50T3JpZ2luRW51bTogRmlsZUF0dGFjaG1lbnRPcmlnaW5FbnVtLFxyXG4gICAgICAgICAgICBwcml2YXRlIGFwcGxpY2F0aW9uT3JpZ2luRW51bTogQXBwbGljYXRpb25PcmlnaW5FbnVtXHJcbiAgICAgICAgKSB7XHJcbiAgICAgICAgICAgIGlmICghdGhpcy5lbGVtZW50SWRCaW5kaW5nKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLiRsb2cuZXJyb3IoJ3BhcmFtZXRlciB7ZWxlbWVudElkQmluZGluZ30gaXMgbWFuZGF0b3J5LicpO1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBpZiAoIXRoaXMuYXBwbGljYXRpb25PcmlnaW5FbnVtW3RoaXMub3JpZ2luQmluZGluZ10pIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuJGxvZy5lcnJvcigncGFyYW1ldGVyIHtvcmlnaW5CaW5kaW5nfSBpcyBtYW5kYXRvcnkuJyk7XHJcbiAgICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIHRoaXMuaHR0cFByb21pc2VzID0gbmV3IEFycmF5PG5nLklQcm9taXNlPGFueT4+KCk7XHJcblxyXG4gICAgICAgICAgICAvLyBnZXQgbGlzdCBvZiBhdHRhY2hlZCBmaWxlcyBmb3IgY3VycmVudCBlbGVtZW50XHJcbiAgICAgICAgICAgIHRoaXMuZ2V0QXR0YWNoZWRGaWxlcygpO1xyXG5cclxuICAgICAgICAgICAgLy8gZ2V0IGZsYWcgdG8ga25vdyBpZiBjdXJyZW50IHVzZXIgaGFzIHVwbG9hZCByaWdodHMgZm9yIGN1cnJlbnQgaXRlbVxyXG4gICAgICAgICAgICB0aGlzLmdldEN1cnJlbnRVc2VyVXBsb2FkUmlnaHRzKCk7XHJcblxyXG4gICAgICAgICAgICAvLyBnZXQgc3VwcG9ydGVkIG1pbWUgdHlwZXMgZm9yIGZpbGUgdXBsb2FkLCBiYXNlZCBvbiBzcnYgaW5mb1xyXG4gICAgICAgICAgICB0aGlzLmdldFN1cHBvcnRlZEV4dGVuc2lvbnMoKTtcclxuXHJcbiAgICAgICAgICAgIHRoaXMubmJPZkl0ZW1zUGVyUGFnZSA9IDEwO1xyXG5cclxuICAgICAgICAgICAgdGhpcy5maWxlSW52YWxpZE1lc3NhZ2VBcnJheSA9IG5ldyBBcnJheTxzdHJpbmc+KCk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAvLyNlbmRyZWdpb25cclxuXHJcbiAgICAgICAgLy8jcmVnaW9uIGZpbGUgYXR0YWNobWVudCBtYW5hZ2VtZW50XHJcblxyXG4gICAgICAgIC8vVE9ETyBNR0E6IGhhbmRsZSBtdWx0aXBsZSBmaWxlcyAmIGNsZWFuIHVwIHZpZXcgYmluZGluZ3NcclxuICAgICAgICBwdWJsaWMgb25GaWxlU2VsZWN0ZWQoZmlsZXM6IEFycmF5PEZpbGU+LCBmaWxlOiBGaWxlLCBuZXdGaWxlczogQXJyYXk8RmlsZT4sIGR1cGxpY2F0ZUZpbGVzOiBBcnJheTxGaWxlPiwgaW52YWxpZEZpbGVzOiBBcnJheTxGaWxlPiwgZXZlbnQ6IEpRdWVyeUV2ZW50T2JqZWN0KTogdm9pZCB7XHJcbiAgICAgICAgICAgIGlmICghZmlsZXMgJiYgIWZpbGUpIHJldHVybjtcclxuXHJcbiAgICAgICAgICAgIHRoaXMuZmlsZUludmFsaWRNZXNzYWdlQXJyYXkgPSBbXTsgLy9yZXNldCBlcnJvciBhcnJheVxyXG5cclxuICAgICAgICAgICAgaWYgKGZpbGVzKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnNlbGVjdGVkRmlsZXMgPSBmaWxlcztcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBpZiAoZmlsZSkge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5zZWxlY3RlZEZpbGUgPSBmaWxlO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBpZiAoZmlsZXMgJiYgZmlsZXMubGVuZ3RoID4gMSkge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5maWxlSW52YWxpZE1lc3NhZ2VBcnJheS5wdXNoKCdDYW5ub3QgdXBsb2FkIG11bHRpcGxlIGZpbGVzIGF0IG9uY2UuIFBsZWFzZSBzZWxlY3Qgb25seSBvbmUgZmlsZS4nKTtcclxuICAgICAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgLy92YXIgZmlsZUV4dGVuc2lvbiA9IGZpbGUubmFtZS5zdWJzdHIoZmlsZS5uYW1lLmxhc3RJbmRleE9mKCcuJykgKyAxKTtcclxuICAgICAgICAgICAgdmFyIGZpbGVGb3JtYXRTdXBwb3J0ZWQgPSBfKHRoaXMuc3VwcG9ydGVkRXh0ZW5zaW9ucykuYW55KHN1cHBvcnRlZEV4dGVuc2lvbiA9PiB0aGlzLnNlbGVjdGVkRmlsZS5nZXRGaWxlRXh0ZW5zaW9uKCkgPT09IHN1cHBvcnRlZEV4dGVuc2lvbi50b0xvd2VyQ2FzZSgpKTtcclxuXHJcbiAgICAgICAgICAgIC8vdmFyIGZpbGVGb3JtYXRTdXBwb3J0ZWQgPSBmaWxlLnR5cGUgJiYgLy9JZiBmaWxlLnR5cGUgaXMgbnVsbCAvIGVtcHR5LCB0aGF0IG1lYW5zIGN1cnJlbnQgT1MgZG9lc24ndCBrbm93IGFib3V0IHRoZSBmaWxlIGZvcm1hdCA9PiBkZWxlZ2F0ZSB0byBzZXJ2ZXIgdG8gdmFsaWRhdGUgaWYgZm9ybWF0IGlzIHZhbGlkLCB3ZSBjYW4ndCBrbm93IGNsaWVudC1zaWRlLlxyXG4gICAgICAgICAgICAvLyAgICBfKHRoaXMuc3VwcG9ydGVkRXh0ZW5zaW9ucykuYW55KChzdXBwb3J0ZWRNaW1lVHlwZSkgPT4gZmlsZS50eXBlID09PSBzdXBwb3J0ZWRNaW1lVHlwZSk7XHJcblxyXG4gICAgICAgICAgICBpZiAoIWZpbGVGb3JtYXRTdXBwb3J0ZWQpXHJcbiAgICAgICAgICAgICAgICB0aGlzLmZpbGVJbnZhbGlkTWVzc2FnZUFycmF5LnB1c2goYFVuc3VwcG9ydGVkIGZpbGUgZm9ybWF0OiAnJHt0aGlzLnNlbGVjdGVkRmlsZS50eXBlfScgd2l0aCBleHRlbnNpb246ICcke3RoaXMuc2VsZWN0ZWRGaWxlLmdldEZpbGVFeHRlbnNpb24oKX0nYCk7XHJcblxyXG4gICAgICAgICAgICBpZiAoIXRoaXMuc2VsZWN0ZWRGaWxlLnNpemUpXHJcbiAgICAgICAgICAgICAgICB0aGlzLmZpbGVJbnZhbGlkTWVzc2FnZUFycmF5LnB1c2goJ1NlbGVjdGVkIGZpbGUgaXMgZW1wdHkuJyk7XHJcbiAgICAgICAgICAgIGVsc2UgaWYgKHRoaXMuc2VsZWN0ZWRGaWxlLnNpemUgPj0gTUFYX0ZJTEVfU0laRSlcclxuICAgICAgICAgICAgICAgIHRoaXMuZmlsZUludmFsaWRNZXNzYWdlQXJyYXkucHVzaChgU2VsZWN0ZWQgZmlsZSBpcyBiaWdnZXIgKCR7dGhpcy5ieXRlc1RvRm9ybWF0ZWRTdHJpbmcodGhpcy5zZWxlY3RlZEZpbGUuc2l6ZSl9KSB0aGFuIGF1dGhvcml6ZWQgZmlsZSBzaXplOiAke3RoaXMuYnl0ZXNUb0Zvcm1hdGVkU3RyaW5nKE1BWF9GSUxFX1NJWkUpfWApO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcHVibGljIGltcG9ydFNlbGVjdGVkRmlsZSgpOiB2b2lkIHtcclxuICAgICAgICAgICAgaWYgKCF0aGlzLnNlbGVjdGVkRmlsZSB8fCBfKHRoaXMuZmlsZUludmFsaWRNZXNzYWdlQXJyYXkpLmFueSgpKSByZXR1cm47IC8vVE9ETyBNR0EgJGxvZ1xyXG5cclxuICAgICAgICAgICAgdmFyIGh0dHBQcm9taXNlID0gdGhpcy5maWxlQXR0YWNobWVudFNlcnZpY2UuYXR0YWNoRmlsZSh0aGlzLmVsZW1lbnRJZEJpbmRpbmcsIHRoaXMub3JpZ2luQmluZGluZywgdGhpcy5zZWxlY3RlZEZpbGUpLnRoZW4oKCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgdGhpcy50b2FzdGVyLnN1Y2Nlc3MoYEZpbGUgKCR7dGhpcy5zZWxlY3RlZEZpbGUubmFtZX0pIHN1Y2Nlc3NmdWxseSB1cGxvYWRlZC5gKTtcclxuICAgICAgICAgICAgICAgIHRoaXMuZ2V0QXR0YWNoZWRGaWxlcygpOyAvL1RPRE8gTUdBIDogaGlnaGxpZ2h0IG5ldyBlbnRyeSA/XHJcbiAgICAgICAgICAgIH0pLmZpbmFsbHkoKCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgLy9jbGVhbiB1cCBzZWxlY3RlZCBmaWxlXHJcbiAgICAgICAgICAgICAgICB0aGlzLmNsZWFyU2VsZWN0ZWRGaWxlcygpO1xyXG4gICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgIHRoaXMuaHR0cFByb21pc2VzLnB1c2goaHR0cFByb21pc2UpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcHVibGljIGNsZWFyU2VsZWN0ZWRGaWxlcygpOiB2b2lkIHtcclxuICAgICAgICAgICAgdGhpcy5zZWxlY3RlZEZpbGVzID0gbnVsbDtcclxuICAgICAgICAgICAgdGhpcy5zZWxlY3RlZEZpbGUgPSBudWxsO1xyXG4gICAgICAgICAgICB0aGlzLmZpbGVJbnZhbGlkTWVzc2FnZUFycmF5ID0gW107IC8vIGNsZWFyIGVycm9yIG1lc3NhZ2VzXHJcbiAgICAgICAgICAgIC8vdGhpcy5maWxlU2VsZWN0ZWRJc1ZhbGlkID0gdHJ1ZTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHB1YmxpYyBkb3dubG9hZEF0dGFjaGVkRmlsZShmaWxlQXR0YWNobWVudDogRmlsZUF0dGFjaG1lbnQpOiB2b2lkIHtcclxuICAgICAgICAgICAgaWYgKCFmaWxlQXR0YWNobWVudCB8fCAhZmlsZUF0dGFjaG1lbnQuSWQpIHJldHVybjtcclxuXHJcbiAgICAgICAgICAgIHZhciBodHRwUHJvbWlzZSA9IHRoaXMuZmlsZUF0dGFjaG1lbnRTZXJ2aWNlLmRvd25sb2FkQXR0YWNoZWRGaWxlKGZpbGVBdHRhY2htZW50LCB0aGlzLmZpbGVBdHRhY2htZW50T3JpZ2luRW51bVtmaWxlQXR0YWNobWVudC5GaWxlT3JpZ2luXSlcclxuICAgICAgICAgICAgICAgIC50aGVuKCgpID0+IHtcclxuICAgICAgICAgICAgICAgICAgICAvL1RPRE8gTUdBID8gb3IgbGVhdmUgYXMgaXMuXHJcbiAgICAgICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgIHRoaXMuaHR0cFByb21pc2VzLnB1c2goaHR0cFByb21pc2UpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcHVibGljIGRlbGV0ZUF0dGFjaGVkRmlsZShmaWxlQXR0YWNobWVudDogRmlsZUF0dGFjaG1lbnQpOiB2b2lkIHtcclxuICAgICAgICAgICAgaWYgKCFmaWxlQXR0YWNobWVudCB8fCAhZmlsZUF0dGFjaG1lbnQuSWQpIHJldHVybjtcclxuXHJcbiAgICAgICAgICAgIHZhciBodHRwUHJvbWlzZSA9IHRoaXMuZmlsZUF0dGFjaG1lbnRTZXJ2aWNlLmRlbGV0ZUF0dGFjaGVkRmlsZShmaWxlQXR0YWNobWVudC5JZCwgdGhpcy5maWxlQXR0YWNobWVudE9yaWdpbkVudW1bZmlsZUF0dGFjaG1lbnQuRmlsZU9yaWdpbl0pXHJcbiAgICAgICAgICAgICAgICAudGhlbigoKSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy50b2FzdGVyLnN1Y2Nlc3MoYEZpbGUgKCR7ZmlsZUF0dGFjaG1lbnQuRmlsZU5hbWV9KSBzdWNjZXNzZnVsbHkgZGVsZXRlZC5gKTtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLmdldEF0dGFjaGVkRmlsZXMoKTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgdGhpcy5odHRwUHJvbWlzZXMucHVzaChodHRwUHJvbWlzZSk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAvL1RPRE8gTUdBOiBleHRyYWN0IHRvIHNlcnZpY2UgLyBleHRlbnNpb24gbWV0aG9kID9cclxuICAgICAgICBwdWJsaWMgYnl0ZXNUb0Zvcm1hdGVkU3RyaW5nKGJ5dGVzOiBudW1iZXIpOiBzdHJpbmcge1xyXG5cclxuICAgICAgICAgICAgaWYgKCFieXRlcykgcmV0dXJuICcwIEJ5dGUnO1xyXG5cclxuICAgICAgICAgICAgdmFyIHJlZmVyZW5jZVNjYWxlID0gMTAwMDsgLy8gb3IgMTAyNCBmb3IgYmluYXJ5IHJlZiB2cy4gU0lcclxuXHJcbiAgICAgICAgICAgIHZhciB1bml0QXJyYXkgPSBbJ0J5dGVzJywgJ0tiJywgJ01iJywgJ0diJywgJ1RiJywgJ1BiJywgJ0ViJywgJ1piJywgJ1liJ107XHJcblxyXG4gICAgICAgICAgICAvLyBnZXQgbGV2ZWwgdG8gYWRvcHQgZm9yIHNpemUgbXVsdGlwbGUgKGJ5dGVzLCBLQiBldGMpLlxyXG4gICAgICAgICAgICB2YXIgdW5pdEluZGV4ID0gTWF0aC5mbG9vcihNYXRoLmxvZyhieXRlcykgLyBNYXRoLmxvZyhyZWZlcmVuY2VTY2FsZSkpO1xyXG5cclxuICAgICAgICAgICAgLy8gMiBkZWNpbWFscywgYW5kIGlmIG9ubHkgT3MgYWZ0ZXIgdGhlICcsJywgdGhlbiBwYXJzZUZsb2F0IHdpbGwgdHJpbSBlbmRpbmcgMHMuXHJcbiAgICAgICAgICAgIHJldHVybiBwYXJzZUZsb2F0KChieXRlcyAvIE1hdGgucG93KHJlZmVyZW5jZVNjYWxlLCB1bml0SW5kZXgpKS50b0ZpeGVkKDIpKSArICcgJyArIHVuaXRBcnJheVt1bml0SW5kZXhdO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgLy8jZW5kcmVnaW9uXHJcblxyXG4gICAgICAgIC8vI3JlZ2lvbiBjb21tZW50IG1hbmFnZW1lbnRcclxuXHJcbiAgICAgICAgcHVibGljIHN3aXRjaFRvRWRpdENvbW1lbnRNb2RlKGZpbGVBdHRhY2htZW50OiBGaWxlQXR0YWNobWVudCkge1xyXG4gICAgICAgICAgICBmaWxlQXR0YWNobWVudC5lZGl0Q29tbWVudE1vZGUgPSB0cnVlO1xyXG4gICAgICAgICAgICAvL3NldCB1cGRhdGVkIGNvbW1lbnQgZmllbGQgdG8gcHJldmlvdXMgY29tbWVudCB2YWx1ZVxyXG4gICAgICAgICAgICBmaWxlQXR0YWNobWVudC51cGRhdGVkQ29tbWVudCA9IGZpbGVBdHRhY2htZW50LkNvbW1lbnQgfHwgXCJcIjtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHB1YmxpYyB1cGRhdGVGaWxlQXR0YWNobWVudENvbW1lbnQoZmlsZUF0dGFjaG1lbnQ6IEZpbGVBdHRhY2htZW50KTogdm9pZCB7XHJcbiAgICAgICAgICAgIGlmICghZmlsZUF0dGFjaG1lbnQgfHwgIWZpbGVBdHRhY2htZW50LklkIHx8ICFmaWxlQXR0YWNobWVudC51cGRhdGVkQ29tbWVudCkgcmV0dXJuO1xyXG5cclxuICAgICAgICAgICAgaWYgKCF0aGlzLm9uVXBkYXRlZENvbW1lbnRWYWxpZGF0ZUlucHV0KGZpbGVBdHRhY2htZW50KSkgcmV0dXJuOyAvLyBjaGVjayB2YWxpZGF0aW9uIHJ1bGVzIGFyZSBva1xyXG5cclxuICAgICAgICAgICAgdmFyIGh0dHBQcm9taXNlID0gdGhpcy5maWxlQXR0YWNobWVudFNlcnZpY2UuZWRpdEZpbGVBdHRhY2htZW50Q29tbWVudChmaWxlQXR0YWNobWVudC5JZCwgdGhpcy5maWxlQXR0YWNobWVudE9yaWdpbkVudW1bZmlsZUF0dGFjaG1lbnQuRmlsZU9yaWdpbl0sIGZpbGVBdHRhY2htZW50LnVwZGF0ZWRDb21tZW50KS50aGVuKCgpID0+IHtcclxuICAgICAgICAgICAgICAgIHRoaXMuY2xlYXJFZGl0Q29tbWVudE1vZGUoZmlsZUF0dGFjaG1lbnQpOyAvL1RPRE8gTUdBOiB1c2VsZXNzIGlmIHdlIHJlbG9hZCBhbGwgZGF0YSBmcm9tIHNydlxyXG4gICAgICAgICAgICAgICAgLy8gcmV0cmlldmUgdXBkYXRlIGxpc3Qgb2YgZmlsZXMgd2l0aCB1cGRhdGVkIGZpbGUgY29tbWVudCBmcm9tIHNydiA6IFRPRE8gTUdBIGltcHJvdmUgcmVsb2FkIChjb3N0bHkpXHJcbiAgICAgICAgICAgICAgICB0aGlzLmdldEF0dGFjaGVkRmlsZXMoKTtcclxuICAgICAgICAgICAgICAgIC8vIFRPRE8gTUdBIDogaGlnaGxpZ2h0IHVwZGF0ZWQgY29tbWVudCA/XHJcbiAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgdGhpcy5odHRwUHJvbWlzZXMucHVzaChodHRwUHJvbWlzZSk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAvKipcclxuICAgICAgICAgKiBUT0RPIE1HQTogaW1wcm92ZSBpbmxpbmUtZm9ybSBlcnJvciBoYW5kbGluZyAmIFVJIGZlZWRiYWNrICEgbm90IGR5bmFtaWMgLy8gZmx1aWQgdG8gdXNlXHJcbiAgICAgICAgICogQHBhcmFtIGZpbGVBdHRhY2htZW50XHJcbiAgICAgICAgICovXHJcbiAgICAgICAgcHVibGljIG9uVXBkYXRlZENvbW1lbnRWYWxpZGF0ZUlucHV0ID0gKGZpbGVBdHRhY2htZW50OiBGaWxlQXR0YWNobWVudCk6IGJvb2xlYW4gPT4ge1xyXG4gICAgICAgICAgICBpZiAoIWZpbGVBdHRhY2htZW50LnVwZGF0ZWRDb21tZW50IHx8IGZpbGVBdHRhY2htZW50LnVwZGF0ZWRDb21tZW50Lmxlbmd0aCA8IDEpIHtcclxuICAgICAgICAgICAgICAgIGZpbGVBdHRhY2htZW50LnVwZGF0ZWRDb21tZW50RXJyb3JNZXNzYWdlID0gJ2NvbW1lbnQgbXVzdCBiZSBub24tZW1wdHknO1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgICAgICAgICB9IGVsc2UgaWYgKGZpbGVBdHRhY2htZW50LnVwZGF0ZWRDb21tZW50ICYmIGZpbGVBdHRhY2htZW50LnVwZGF0ZWRDb21tZW50Lmxlbmd0aCA+PSBNQVhfQ09NTUVOVF9MRU5HVEgpIHtcclxuICAgICAgICAgICAgICAgIGZpbGVBdHRhY2htZW50LnVwZGF0ZWRDb21tZW50RXJyb3JNZXNzYWdlID0gYGNvbW1lbnQgbXVzdCBiZSA8ICR7TUFYX0NPTU1FTlRfTEVOR1RIfSBjaGFyYWN0ZXJzYDtcclxuICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIGZpbGVBdHRhY2htZW50LnVwZGF0ZWRDb21tZW50RXJyb3JNZXNzYWdlID0gbnVsbDsgLy9yZXNldCBlcnJvciBtZXNzYWdlIHRvIGZsYWcgY29tbWVudCBhcyB2YWxpZFxyXG4gICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIC8qKlxyXG4gICAgICAgICAqIEhhbmRsZXIgZGVkaWNhdGVkIHRvIHByZXZlbnQgb24ga2V5cHJlc3M9J2VudGVyJyB0aGUgc3VibWlzc2lvbiBvZiBhIGZvcm0gaWYgdGhpcyBjb21wb25lbnQgaXMgaW5zaWRlIG9uZS5cclxuICAgICAgICAgKiBJbnN0ZWFkLCBpdCBwdXNoZXMgdGhlIG5ldyB2YWx1ZSBcclxuICAgICAgICAgKi9cclxuICAgICAgICBwdWJsaWMgb25Db21tZW50SW5wdXRLZXlQcmVzcyA9ICgkZXZlbnQ6IEpRdWVyeUV2ZW50T2JqZWN0LCBmaWxlQXR0YWNobWVudDogRmlsZUF0dGFjaG1lbnQpOiB2b2lkID0+IHtcclxuXHJcbiAgICAgICAgICAgIHZhciBrZXlDb2RlID0gJGV2ZW50LmtleUNvZGUgfHwgJGV2ZW50LndoaWNoO1xyXG5cclxuICAgICAgICAgICAgaWYgKGtleUNvZGUgPT09IDEzKSB7IC8vICdFbnRlcicga2V5IHByZXNzZWRcclxuICAgICAgICAgICAgICAgIC8vcHJldmVudCBmb3JtIHN1Ym1pc3Npb25cclxuICAgICAgICAgICAgICAgICRldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xyXG4gICAgICAgICAgICAgICAgLy9jYWxsIFxyXG4gICAgICAgICAgICAgICAgdGhpcy51cGRhdGVGaWxlQXR0YWNobWVudENvbW1lbnQoZmlsZUF0dGFjaG1lbnQpO1xyXG5cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcHVibGljIGNhbmNlbEVkaXRDb21tZW50KGZpbGVBdHRhY2htZW50OiBGaWxlQXR0YWNobWVudCk6IHZvaWQge1xyXG4gICAgICAgICAgICBmaWxlQXR0YWNobWVudC5lZGl0Q29tbWVudE1vZGUgPSBmYWxzZTtcclxuICAgICAgICAgICAgLy9maWxlQXR0YWNobWVudC51cGRhdGVkQ29tbWVudCA9IFwiXCI7IC8vIFRPRE8gTUdBOiBkZWNpZGUgYmVoYXZpb3IgPyBiZXR0ZXIgdG8ga2VlcCBsYXN0IGVudHJ5ID8gYnV0IHRoZW4gd2UgbXVzdCBhbHNvIGtlZXAgZXJyb3IgbWVzc2FnZVxyXG4gICAgICAgICAgICAvL2ZpbGVBdHRhY2htZW50LnVwZGF0ZWRDb21tZW50RXJyb3JNZXNzYWdlID0gbnVsbDtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIC8vI2VuZHJlZ2lvblxyXG5cclxuICAgICAgICAvLyNlbmRyZWdpb25cclxuXHJcbiAgICAgICAgLy8jcmVnaW9uIHByaXZhdGUgbWV0aG9kc1xyXG5cclxuICAgICAgICBwcml2YXRlIGdldEF0dGFjaGVkRmlsZXMoKTogdm9pZCB7XHJcbiAgICAgICAgICAgIHZhciBodHRwUHJvbWlzZSA9IHRoaXMuZmlsZUF0dGFjaG1lbnRTZXJ2aWNlLmdldEF0dGFjaGVkRmlsZXModGhpcy5lbGVtZW50SWRCaW5kaW5nLCB0aGlzLm9yaWdpbkJpbmRpbmcpLnRoZW4oKGZpbGVBdHRhY2htZW50TGlzdCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5hdHRhY2hlZEZpbGVMaXN0ID0gZmlsZUF0dGFjaG1lbnRMaXN0O1xyXG4gICAgICAgICAgICAgICAgdGhpcy5hdHRhY2hlZEZpbGVMaXN0U291cmNlID0gZmlsZUF0dGFjaG1lbnRMaXN0OyAvL1RPRE8gTUdBIDogZHVwbGljYXRlID8gdG8gcHJldmVudCB1cGRhdGUgdG8gc291cmNlIGxpc3QgaWYgY29sbGVjdGlvbiBtb2RpZmllZCA/XHJcbiAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgdGhpcy5odHRwUHJvbWlzZXMucHVzaChodHRwUHJvbWlzZSk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBwcml2YXRlIGdldFN1cHBvcnRlZEV4dGVuc2lvbnMoKTogdm9pZCB7XHJcbiAgICAgICAgICAgIHZhciBodHRwUHJvbWlzZSA9IHRoaXMuZmlsZUF0dGFjaG1lbnRTZXJ2aWNlLmdldFN1cHBvcnRlZEV4dGVuc2lvbnMoKS50aGVuKChzdXBwb3J0ZWRFeHRlbnNpb25zKSA9PiB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnN1cHBvcnRlZEV4dGVuc2lvbnMgPSBfKHN1cHBvcnRlZEV4dGVuc2lvbnMpLnVuaXEoKTtcclxuICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICB0aGlzLmh0dHBQcm9taXNlcy5wdXNoKGh0dHBQcm9taXNlKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHByaXZhdGUgY2xlYXJFZGl0Q29tbWVudE1vZGUoZmlsZUF0dGFjaG1lbnQ6IEZpbGVBdHRhY2htZW50KSB7XHJcbiAgICAgICAgICAgIGZpbGVBdHRhY2htZW50LmVkaXRDb21tZW50TW9kZSA9IGZhbHNlO1xyXG4gICAgICAgICAgICBmaWxlQXR0YWNobWVudC51cGRhdGVkQ29tbWVudCA9IG51bGw7XHJcbiAgICAgICAgICAgIGZpbGVBdHRhY2htZW50LnVwZGF0ZWRDb21tZW50RXJyb3JNZXNzYWdlID0gbnVsbDtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHByaXZhdGUgZ2V0Q3VycmVudFVzZXJVcGxvYWRSaWdodHMoKTogdm9pZCB7XHJcbiAgICAgICAgICAgIHRoaXMuZmlsZUF0dGFjaG1lbnRTZXJ2aWNlXHJcbiAgICAgICAgICAgICAgICAuZ2V0Q3VycmVudFVzZXJVcGxvYWRSaWdodHModGhpcy5lbGVtZW50SWRCaW5kaW5nLCB0aGlzLm9yaWdpbkJpbmRpbmcpXHJcbiAgICAgICAgICAgICAgICAudGhlbihib29sZWFuUmVzcG9uc2UgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuaGFzQ3VycmVudFVzZXJVcGxvYWRSaWdodHMgPSBib29sZWFuUmVzcG9uc2U7XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIC8vI2VuZHJlZ2lvblxyXG4gICAgfVxyXG5cclxuICAgIGV4cG9ydCBjbGFzcyBGaWxlQXR0YWNobWVudENvbXBvbmVudCBpbXBsZW1lbnRzIG5nLklDb21wb25lbnRPcHRpb25zIHtcclxuXHJcbiAgICAgICAgcHVibGljIGJpbmRpbmdzOiBhbnk7XHJcbiAgICAgICAgcHVibGljIGNvbnRyb2xsZXI6IGFueTtcclxuICAgICAgICBwdWJsaWMgY29udHJvbGxlckFzOiBzdHJpbmc7XHJcbiAgICAgICAgcHVibGljIHRlbXBsYXRlVXJsOiBzdHJpbmc7XHJcblxyXG4gICAgICAgIGNvbnN0cnVjdG9yKCkge1xyXG5cclxuICAgICAgICAgICAgdGhpcy5iaW5kaW5ncyA9IHtcclxuICAgICAgICAgICAgICAgIGVsZW1lbnRJZEJpbmRpbmc6ICc9JyxcclxuICAgICAgICAgICAgICAgIG9yaWdpbkJpbmRpbmc6ICc9J1xyXG4gICAgICAgICAgICB9O1xyXG5cclxuICAgICAgICAgICAgdGhpcy5jb250cm9sbGVyID0gRmlsZUF0dGFjaG1lbnRDb21wb25lbnRDb250cm9sbGVyO1xyXG4gICAgICAgICAgICB0aGlzLmNvbnRyb2xsZXJBcyA9ICd2bSc7XHJcbiAgICAgICAgICAgIHRoaXMudGVtcGxhdGVVcmwgPSAnY29tcG9uZW50L2ZpbGUtYXR0YWNobWVudC50cGwuaHRtbCc7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIGFuZ3VsYXIubW9kdWxlKCdibHVlc2t5LmNvcmUuY29tcG9uZW50cy5maWxlQXR0YWNobWVudCcsIFtcclxuICAgICAgICAnY2dCdXN5JyxcclxuICAgICAgICAnc21hcnQtdGFibGUnLFxyXG4gICAgICAgICd0b2FzdGVyJyxcclxuICAgICAgICAnZmlsZS1hdHRhY2htZW50LWNvbXBvbmVudC10cGwnLFxyXG4gICAgICAgICdibHVlc2t5LmNvcmUuc2VydmljZXMuZmlsZUF0dGFjaG1lbnQnLFxyXG4gICAgICAgICdibHVlc2t5LmNvcmUubW9kZWxzLmZpbGVBdHRhY2htZW50T3JpZ2luRW51bScsXHJcbiAgICAgICAgJ2JsdWVza3kuY29yZS5tb2RlbHMuYXBwbGljYXRpb25PcmlnaW5FbnVtJ1xyXG4gICAgXSlcclxuICAgICAgICAvL1RPRE8gTUdBOiBtYWtlIHRoaXMgdW5pZm9ybSBmb3IgZWFjaCBkaXJlY3RpdmVzIC8vIHNoYXJlIGJlaGF2aW9yXHJcbiAgICAgICAgLnZhbHVlKCdjZ0J1c3lEZWZhdWx0cycsIHsgdGVtcGxhdGVVcmw6ICd0ZW1wbGF0ZXMvYW5ndWxhci1idXN5L2FuZ3VsYXItYnVzeS1jdXN0b20udHBsLmh0bWwnIH0pXHJcbiAgICAgICAgLmNvbnN0YW50KCdfJywgd2luZG93WydfJ10pXHJcbiAgICAgICAgLmNvbnN0YW50KCdtb21lbnQnLCB3aW5kb3dbJ21vbWVudCddKVxyXG4gICAgICAgIC5jb21wb25lbnQoJ2ZpbGVBdHRhY2htZW50Q29tcG9uZW50JywgbmV3IEZpbGVBdHRhY2htZW50Q29tcG9uZW50KCkpO1xyXG5cclxufSIsInZhciBibHVlc2t5O1xuKGZ1bmN0aW9uIChibHVlc2t5KSB7XG4gICAgdmFyIGNvcmU7XG4gICAgKGZ1bmN0aW9uIChjb3JlKSB7XG4gICAgICAgIHZhciBzZXJ2aWNlcztcbiAgICAgICAgKGZ1bmN0aW9uIChzZXJ2aWNlcykge1xuICAgICAgICAgICAgdmFyIEZpbGVBdHRhY2htZW50U2VydmljZSA9IChmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgLyogQG5nSW5qZWN0ICovXG4gICAgICAgICAgICAgICAgZnVuY3Rpb24gRmlsZUF0dGFjaG1lbnRTZXJ2aWNlKGh0dHBXcmFwcGVyU2VydmljZSwgJGxvZywgJHRpbWVvdXQsIFVwbG9hZCwgQmxvYiwgLy9UT0RPIE1HQTogdHlwaW5ncyA/XG4gICAgICAgICAgICAgICAgICAgIEZpbGVTYXZlciwgLy9UT0RPIE1HQTogdHlwaW5ncyA/XG4gICAgICAgICAgICAgICAgICAgIGZpbGVBdHRhY2htZW50T3JpZ2luRW51bSwgYXBwbGljYXRpb25PcmlnaW5FbnVtKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuaHR0cFdyYXBwZXJTZXJ2aWNlID0gaHR0cFdyYXBwZXJTZXJ2aWNlO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLiRsb2cgPSAkbG9nO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLiR0aW1lb3V0ID0gJHRpbWVvdXQ7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuVXBsb2FkID0gVXBsb2FkO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLkJsb2IgPSBCbG9iO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLkZpbGVTYXZlciA9IEZpbGVTYXZlcjtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5maWxlQXR0YWNobWVudE9yaWdpbkVudW0gPSBmaWxlQXR0YWNobWVudE9yaWdpbkVudW07XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuYXBwbGljYXRpb25PcmlnaW5FbnVtID0gYXBwbGljYXRpb25PcmlnaW5FbnVtO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBGaWxlQXR0YWNobWVudFNlcnZpY2UucHJvdG90eXBlLmdldEF0dGFjaGVkRmlsZXMgPSBmdW5jdGlvbiAoZWxlbWVudElkLCBhcHBsaWNhdGlvbk9yaWdpbikge1xuICAgICAgICAgICAgICAgICAgICAvL1RPRE8gTUdBIDogY2xlYW5lciBwYXJhbXMgaGFuZGxpbmcgdG8gcGFzcyB0byBodHRwIGNhbGxcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuaHR0cFdyYXBwZXJTZXJ2aWNlLmdldCgnZmlsZS1hdHRhY2htZW50L3NlYXJjaCcsIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHBhcmFtczogeyAnZWxlbWVudElkJzogZWxlbWVudElkLCAnYXBwbGljYXRpb25PcmlnaW4nOiB0aGlzLmFwcGxpY2F0aW9uT3JpZ2luRW51bVthcHBsaWNhdGlvbk9yaWdpbl0gfSxcbiAgICAgICAgICAgICAgICAgICAgICAgIGFwaUVuZHBvaW50OiB0cnVlXG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICAgICAgRmlsZUF0dGFjaG1lbnRTZXJ2aWNlLnByb3RvdHlwZS5hdHRhY2hGaWxlID0gZnVuY3Rpb24gKGVsZW1lbnRJZCwgYXBwbGljYXRpb25PcmlnaW4sIGZpbGVUb1VwbG9hZCkge1xuICAgICAgICAgICAgICAgICAgICB2YXIgX3RoaXMgPSB0aGlzO1xuICAgICAgICAgICAgICAgICAgICBpZiAoIWZpbGVUb1VwbG9hZCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy4kbG9nLndhcm4oJ1tmaWxlQXR0YWNobWVudFNlcnZpY2UuYXR0YWNoRmlsZV0gZmlsZSBpcyBlbXB0eSwgYWJvcnRpbmcgdXBsb2FkLicpO1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgLy9UT0RPIE1HQTogd2Ugc2hvdWxkIHJlbHkgb24gYSBzdHJvbmdlciBodHRwLXdyYXBwZXIgdG8gaGFuZGxlIHVwbG9hZCB0aGlzIHdheVxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5VcGxvYWQuYmFzZTY0RGF0YVVybChmaWxlVG9VcGxvYWQpLnRoZW4oZnVuY3Rpb24gKGZpbGVCYXNlNjRVcmwpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBfdGhpcy5odHRwV3JhcHBlclNlcnZpY2UucG9zdCgnZmlsZS1hdHRhY2htZW50L3B1dCcsIFxuICAgICAgICAgICAgICAgICAgICAgICAgLy9UT0RPIE1HQSA6IGNyZWF0ZSBtb2RlbCBmb3IgQXR0YWNoRmlsZUR0byAmIEZpbGVVcGxvYWRCYXNlRHRvXG4gICAgICAgICAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgJ0VsZW1lbnRJZCc6IGVsZW1lbnRJZCxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAnQXBwbGljYXRpb25PcmlnaW4nOiBfdGhpcy5hcHBsaWNhdGlvbk9yaWdpbkVudW1bYXBwbGljYXRpb25PcmlnaW5dLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICdGaWxlVXBsb2FkQmFzZUR0byc6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ0ZpbGVOYW1lJzogZmlsZVRvVXBsb2FkLm5hbWUsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdGaWxlQmFzZTY0VXJsJzogZmlsZUJhc2U2NFVybC5zbGljZShmaWxlQmFzZTY0VXJsLmluZGV4T2YoJ2Jhc2U2NCwnKSArICdiYXNlNjQsJy5sZW5ndGgpLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnQ29udGVudFR5cGUnOiBmaWxlVG9VcGxvYWQudHlwZVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIH0sIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhcGlFbmRwb2ludDogdHJ1ZSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB1cGxvYWRJbkJhc2U2NEpzb246IHRydWVcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgIEZpbGVBdHRhY2htZW50U2VydmljZS5wcm90b3R5cGUuZG93bmxvYWRBdHRhY2hlZEZpbGUgPSBmdW5jdGlvbiAoZmlsZUF0dGFjaG1lbnQsIGZpbGVPcmlnaW4pIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIF90aGlzID0gdGhpcztcbiAgICAgICAgICAgICAgICAgICAgaWYgKCFmaWxlQXR0YWNobWVudCB8fCAhZmlsZUF0dGFjaG1lbnQuSWQgfHwgIWZpbGVBdHRhY2htZW50LkZpbGVOYW1lKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLiRsb2cuZXJyb3IoJ1tmaWxlQXR0YWNobWVudF0gbWFuZGF0b3J5LicpO1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuaHR0cFdyYXBwZXJTZXJ2aWNlLmdldEZpbGUoJ2ZpbGUtYXR0YWNobWVudC9kb3dubG9hZCcsIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHBhcmFtczogeyAnZmlsZUF0dGFjaG1lbnRJZCc6IGZpbGVBdHRhY2htZW50LklkLCAnZmlsZU9yaWdpbic6IHRoaXMuZmlsZUF0dGFjaG1lbnRPcmlnaW5FbnVtW2ZpbGVPcmlnaW5dIH0sXG4gICAgICAgICAgICAgICAgICAgICAgICBhcGlFbmRwb2ludDogdHJ1ZVxuICAgICAgICAgICAgICAgICAgICB9KS50aGVuKGZ1bmN0aW9uIChmaWxlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAvL1RPRE8gTUdBOiBleHRyYWN0IGZpbGUgZG93bmxvYWQgYXMgYSBzZXBhcmF0ZSBzZXJ2aWNlXG4gICAgICAgICAgICAgICAgICAgICAgICAvL3ZhciBmaWxld2l0aEJPTSA9ICdcXHVGRUZGJysgZmlsZTsgLy9BZGQgQk9NIFVURi04IGJlZm9yZSA/IGZvciBub3cgZGVsYXllZCB0byBGaWxlU2F2ZXIuc2F2ZUFzKCkgZmxhZyBhdXRvQk9NIHBhcmFtZXRlci5cbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBibG9iID0gbmV3IEJsb2IoW2ZpbGUuY29udGVudF0sIHsgdHlwZTogZmlsZS50eXBlIH0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgLy92YXIgYmxvYiA9IG5ldyBCbG9iKFtmaWxlXSwgeyB0eXBlOiAnYXBwbGljYXRpb24vb2N0ZXQtc3RyZWFtO3V0Zi04JyB9KTtcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vdmFyIGJsb2IgPSBuZXcgQmxvYihbZmlsZV0sIHsgdHlwZTogJ2ltYWdlL3BuZztjaGFyc2V0PXdpbmRvd3MtMTI1MicgfSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAvL3ZhciBibG9iID0gbmV3IEJsb2IoW2ZpbGVdLCB7IHR5cGU6ICdpbWFnZS9wbmc7Y2hhcnNldD1JU08tODg1OS0xJyB9KTtcbiAgICAgICAgICAgICAgICAgICAgICAgIF90aGlzLkZpbGVTYXZlci5zYXZlQXMoYmxvYiwgZmlsZS5uYW1lIHx8IGZpbGVBdHRhY2htZW50LkZpbGVOYW1lIHx8ICd1bmtub3duLmJpbicpOyAvLyBhdXRvQk9NIGVuYWJsZWQgYnkgZGVmYXVsdFxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgIEZpbGVBdHRhY2htZW50U2VydmljZS5wcm90b3R5cGUuZGVsZXRlQXR0YWNoZWRGaWxlID0gZnVuY3Rpb24gKGZpbGVBdHRhY2htZW50SWQsIGZpbGVPcmlnaW4pIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuaHR0cFdyYXBwZXJTZXJ2aWNlLmRlbGV0ZSgnZmlsZS1hdHRhY2htZW50L2RlbGV0ZScsIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHBhcmFtczogeyAnZmlsZUF0dGFjaG1lbnRJZCc6IGZpbGVBdHRhY2htZW50SWQsICdmaWxlT3JpZ2luJzogdGhpcy5maWxlQXR0YWNobWVudE9yaWdpbkVudW1bZmlsZU9yaWdpbl0gfSxcbiAgICAgICAgICAgICAgICAgICAgICAgIGFwaUVuZHBvaW50OiB0cnVlXG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICAgICAgRmlsZUF0dGFjaG1lbnRTZXJ2aWNlLnByb3RvdHlwZS5lZGl0RmlsZUF0dGFjaG1lbnRDb21tZW50ID0gZnVuY3Rpb24gKGZpbGVBdHRhY2htZW50SWQsIGZpbGVPcmlnaW4sIHVwZGF0ZWRDb21tZW50KSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLmh0dHBXcmFwcGVyU2VydmljZS5wb3N0KCdmaWxlLWF0dGFjaG1lbnQvdXBkYXRlLWNvbW1lbnQnLCBcbiAgICAgICAgICAgICAgICAgICAgLy9UT0RPIE1HQSA6IGNyZWF0ZSBEdG8gY2xpZW50LXNpZGUgb3IgdXBkYXRlIGVuZHBvaW50IHNydi1zaWRlIHRvIHN1cHBvcnQgcGFydC1wYXJhbXMgdXJsICsgY29tbWVudCBhcyBwYXlsb2FkIChjbGVhbmVyIFNPQykuXG4gICAgICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICdGaWxlQXR0YWNobWVudElkJzogZmlsZUF0dGFjaG1lbnRJZCxcbiAgICAgICAgICAgICAgICAgICAgICAgICdGaWxlT3JpZ2luJzogdGhpcy5maWxlQXR0YWNobWVudE9yaWdpbkVudW1bZmlsZU9yaWdpbl0sXG4gICAgICAgICAgICAgICAgICAgICAgICAnQ29tbWVudCc6IHVwZGF0ZWRDb21tZW50XG4gICAgICAgICAgICAgICAgICAgIH0sIHsgYXBpRW5kcG9pbnQ6IHRydWUgfSk7XG4gICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICBGaWxlQXR0YWNobWVudFNlcnZpY2UucHJvdG90eXBlLmdldFN1cHBvcnRlZEV4dGVuc2lvbnMgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLmh0dHBXcmFwcGVyU2VydmljZS5nZXQoJ2ZpbGUtYXR0YWNobWVudC9hdXRob3JpemVkLWZpbGUtZXh0ZW5zaW9ucycsIHsgYXBpRW5kcG9pbnQ6IHRydWUgfSk7XG4gICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICBGaWxlQXR0YWNobWVudFNlcnZpY2UucHJvdG90eXBlLmdldFN1cHBvcnRlZE1pbWVUeXBlcyA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuaHR0cFdyYXBwZXJTZXJ2aWNlLmdldCgnZmlsZS1hdHRhY2htZW50L2F1dGhvcml6ZWQtbWltZS10eXBlcycsIHsgYXBpRW5kcG9pbnQ6IHRydWUgfSk7XG4gICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICBGaWxlQXR0YWNobWVudFNlcnZpY2UucHJvdG90eXBlLmdldEN1cnJlbnRVc2VyVXBsb2FkUmlnaHRzID0gZnVuY3Rpb24gKGVsZW1lbnRJZCwgYXBwbGljYXRpb25PcmlnaW4pIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuaHR0cFdyYXBwZXJTZXJ2aWNlLmdldCgnZmlsZS1hdHRhY2htZW50L2dldC1jdXJyZW50LXVzZXItdXBsb2FkLXJpZ2h0cycsIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHBhcmFtczogeyAnZWxlbWVudElkJzogZWxlbWVudElkLCAnYXBwbGljYXRpb25PcmlnaW4nOiB0aGlzLmFwcGxpY2F0aW9uT3JpZ2luRW51bVthcHBsaWNhdGlvbk9yaWdpbl0gfSxcbiAgICAgICAgICAgICAgICAgICAgICAgIGFwaUVuZHBvaW50OiB0cnVlXG4gICAgICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgICAgICAgICAgICAudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHsgcmV0dXJuIHJlc3BvbnNlLmJvb2xlYW5SZXNwb25zZTsgfSk7XG4gICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICByZXR1cm4gRmlsZUF0dGFjaG1lbnRTZXJ2aWNlO1xuICAgICAgICAgICAgfSgpKTtcbiAgICAgICAgICAgIHNlcnZpY2VzLkZpbGVBdHRhY2htZW50U2VydmljZSA9IEZpbGVBdHRhY2htZW50U2VydmljZTtcbiAgICAgICAgICAgIGFuZ3VsYXIubW9kdWxlKCdibHVlc2t5LmNvcmUuc2VydmljZXMuZmlsZUF0dGFjaG1lbnQnLCBbXG4gICAgICAgICAgICAgICAgJ25nLmh0dHBXcmFwcGVyJyxcbiAgICAgICAgICAgICAgICAnbmdGaWxlVXBsb2FkJyxcbiAgICAgICAgICAgICAgICAnbmdGaWxlU2F2ZXInLFxuICAgICAgICAgICAgICAgICdibHVlc2t5LmNvcmUubW9kZWxzLmZpbGVBdHRhY2htZW50T3JpZ2luRW51bScsXG4gICAgICAgICAgICAgICAgJ2JsdWVza3kuY29yZS5tb2RlbHMuYXBwbGljYXRpb25PcmlnaW5FbnVtJ1xuICAgICAgICAgICAgXSkuc2VydmljZSgnZmlsZUF0dGFjaG1lbnRTZXJ2aWNlJywgRmlsZUF0dGFjaG1lbnRTZXJ2aWNlKTtcbiAgICAgICAgfSkoc2VydmljZXMgPSBjb3JlLnNlcnZpY2VzIHx8IChjb3JlLnNlcnZpY2VzID0ge30pKTtcbiAgICB9KShjb3JlID0gYmx1ZXNreS5jb3JlIHx8IChibHVlc2t5LmNvcmUgPSB7fSkpO1xufSkoYmx1ZXNreSB8fCAoYmx1ZXNreSA9IHt9KSk7XG5cbi8vVE9ETyBNR0E6IHZlcnkgaW1wb3J0YW50IHRvIG5vdCB1c2UgZGVsZWdhdGUgaGVyZSwgb3RoZXJ3aXNlIHRoaXMgaXMgYmFkbHkgY2FwdHVyZWQuIGl0IE1VU1QgYmUgYW4gYW5vbnltb3VzIGZ1bmN0aW9uLlxuRmlsZS5wcm90b3R5cGUuZ2V0RmlsZUV4dGVuc2lvbiA9IGZ1bmN0aW9uICgpIHtcbiAgICByZXR1cm4gdGhpcy5uYW1lLnN1YnN0cih0aGlzLm5hbWUubGFzdEluZGV4T2YoJy4nKSArIDEpLnRvTG93ZXJDYXNlKCk7XG59O1xuXG52YXIgYmx1ZXNreTtcbihmdW5jdGlvbiAoYmx1ZXNreSkge1xuICAgIHZhciBjb3JlO1xuICAgIChmdW5jdGlvbiAoY29yZSkge1xuICAgICAgICB2YXIgbW9kZWxzO1xuICAgICAgICAoZnVuY3Rpb24gKG1vZGVscykge1xuICAgICAgICAgICAgLyoqXG4gICAgICAgICAgICAgKiBUT0RPIE1HQSA6IGRlY2lkZSBvbiBwcmFjdGljZSB0byBzaGFyZSBlbnVtcyB3aXRoIHNydiBldGNcbiAgICAgICAgICAgICAqL1xuICAgICAgICAgICAgKGZ1bmN0aW9uIChBcHBsaWNhdGlvbk9yaWdpbkVudW0pIHtcbiAgICAgICAgICAgICAgICBBcHBsaWNhdGlvbk9yaWdpbkVudW1bQXBwbGljYXRpb25PcmlnaW5FbnVtW1wiUXVvdGVXaXphcmRcIl0gPSAwXSA9IFwiUXVvdGVXaXphcmRcIjtcbiAgICAgICAgICAgICAgICBBcHBsaWNhdGlvbk9yaWdpbkVudW1bQXBwbGljYXRpb25PcmlnaW5FbnVtW1wiT3JkZXJFbnRyeVwiXSA9IDFdID0gXCJPcmRlckVudHJ5XCI7XG4gICAgICAgICAgICAgICAgQXBwbGljYXRpb25PcmlnaW5FbnVtW0FwcGxpY2F0aW9uT3JpZ2luRW51bVtcIk9yZGVyVHJhY2tpbmdcIl0gPSAyXSA9IFwiT3JkZXJUcmFja2luZ1wiO1xuICAgICAgICAgICAgfSkobW9kZWxzLkFwcGxpY2F0aW9uT3JpZ2luRW51bSB8fCAobW9kZWxzLkFwcGxpY2F0aW9uT3JpZ2luRW51bSA9IHt9KSk7XG4gICAgICAgICAgICB2YXIgQXBwbGljYXRpb25PcmlnaW5FbnVtID0gbW9kZWxzLkFwcGxpY2F0aW9uT3JpZ2luRW51bTtcbiAgICAgICAgICAgIC8qKlxuICAgICAgICAgICAgICogZGVjbGFyZWQgYXMgYW5ndWxhciBtb2R1bGUgdG8gYmUgaW5qZWN0ZWQgYXQgcnVudGltZSBpbnNpZGUgY29udHJvbGxlcnMvc2VydmljZXMgdG8gdXNlIGl0IGFzIGEgZGljdGlvbm5hcnkuXG4gICAgICAgICAgICAgKiBPdGhlcndpc2UsIHdlIGFyZSBub3Qgc3VyZSB0aGUgcmVmZXJlbmNlIHRvIHRoaXMgb2JqZWN0IHdpbGwgdmUga25vd24gYXQgcnVudGltZSBkdWUgdG8gb3JkZXIgb2YgZXZhbHVhdGlvbiBvZiBpbXBvcnRzIGluc2lkZSBnZW5lcmF0ZWQganMuXG4gICAgICAgICAgICAgKi9cbiAgICAgICAgICAgIGFuZ3VsYXIubW9kdWxlKCdibHVlc2t5LmNvcmUubW9kZWxzLmFwcGxpY2F0aW9uT3JpZ2luRW51bScsIFtdKVxuICAgICAgICAgICAgICAgIC5jb25zdGFudCgnYXBwbGljYXRpb25PcmlnaW5FbnVtJywgQXBwbGljYXRpb25PcmlnaW5FbnVtKTtcbiAgICAgICAgfSkobW9kZWxzID0gY29yZS5tb2RlbHMgfHwgKGNvcmUubW9kZWxzID0ge30pKTtcbiAgICB9KShjb3JlID0gYmx1ZXNreS5jb3JlIHx8IChibHVlc2t5LmNvcmUgPSB7fSkpO1xufSkoYmx1ZXNreSB8fCAoYmx1ZXNreSA9IHt9KSk7XG5cbnZhciBibHVlc2t5O1xuKGZ1bmN0aW9uIChibHVlc2t5KSB7XG4gICAgdmFyIGNvcmU7XG4gICAgKGZ1bmN0aW9uIChjb3JlKSB7XG4gICAgICAgIHZhciBtb2RlbHM7XG4gICAgICAgIChmdW5jdGlvbiAobW9kZWxzKSB7XG4gICAgICAgICAgICAvKipcbiAgICAgICAgICAgICAqIFRPRE8gTUdBIDogZGVjaWRlIG9uIHByYWN0aWNlIHRvIHNoYXJlIGVudW1zIHdpdGggc3J2IGV0Y1xuICAgICAgICAgICAgICovXG4gICAgICAgICAgICAoZnVuY3Rpb24gKEZpbGVBdHRhY2htZW50T3JpZ2luRW51bSkge1xuICAgICAgICAgICAgICAgIEZpbGVBdHRhY2htZW50T3JpZ2luRW51bVtGaWxlQXR0YWNobWVudE9yaWdpbkVudW1bXCJRdW90ZVdpemFyZEZpbGVBdHRhY2htZW50XCJdID0gMF0gPSBcIlF1b3RlV2l6YXJkRmlsZUF0dGFjaG1lbnRcIjtcbiAgICAgICAgICAgICAgICBGaWxlQXR0YWNobWVudE9yaWdpbkVudW1bRmlsZUF0dGFjaG1lbnRPcmlnaW5FbnVtW1wiT3JkZXJFbnRyeUN1c3RvbURldGFpbHNcIl0gPSAxXSA9IFwiT3JkZXJFbnRyeUN1c3RvbURldGFpbHNcIjtcbiAgICAgICAgICAgICAgICBGaWxlQXR0YWNobWVudE9yaWdpbkVudW1bRmlsZUF0dGFjaG1lbnRPcmlnaW5FbnVtW1wiT3JkZXJFbnRyeUF1ZGlvQ3VzdG9tRGV0YWlsXCJdID0gMl0gPSBcIk9yZGVyRW50cnlBdWRpb0N1c3RvbURldGFpbFwiO1xuICAgICAgICAgICAgICAgIEZpbGVBdHRhY2htZW50T3JpZ2luRW51bVtGaWxlQXR0YWNobWVudE9yaWdpbkVudW1bXCJPcmRlclRyYWNraW5nRmlsZUF0dGFjaG1lbnRcIl0gPSAzXSA9IFwiT3JkZXJUcmFja2luZ0ZpbGVBdHRhY2htZW50XCI7XG4gICAgICAgICAgICB9KShtb2RlbHMuRmlsZUF0dGFjaG1lbnRPcmlnaW5FbnVtIHx8IChtb2RlbHMuRmlsZUF0dGFjaG1lbnRPcmlnaW5FbnVtID0ge30pKTtcbiAgICAgICAgICAgIHZhciBGaWxlQXR0YWNobWVudE9yaWdpbkVudW0gPSBtb2RlbHMuRmlsZUF0dGFjaG1lbnRPcmlnaW5FbnVtO1xuICAgICAgICAgICAgLyoqXG4gICAgICAgICAgICAgKiBkZWNsYXJlZCBhcyBhbmd1bGFyIG1vZHVsZSB0byBiZSBpbmplY3RlZCBhdCBydW50aW1lIGluc2lkZSBjb250cm9sbGVycy9zZXJ2aWNlcyB0byB1c2UgaXQgYXMgYSBkaWN0aW9ubmFyeS5cbiAgICAgICAgICAgICAqIE90aGVyd2lzZSwgd2UgYXJlIG5vdCBzdXJlIHRoZSByZWZlcmVuY2UgdG8gdGhpcyBvYmplY3Qgd2lsbCB2ZSBrbm93biBhdCBydW50aW1lIGR1ZSB0byBvcmRlciBvZiBldmFsdWF0aW9uIG9mIGltcG9ydHMgaW5zaWRlIGdlbmVyYXRlZCBqcy5cbiAgICAgICAgICAgICAqL1xuICAgICAgICAgICAgYW5ndWxhci5tb2R1bGUoJ2JsdWVza3kuY29yZS5tb2RlbHMuZmlsZUF0dGFjaG1lbnRPcmlnaW5FbnVtJywgW10pXG4gICAgICAgICAgICAgICAgLmNvbnN0YW50KCdmaWxlQXR0YWNobWVudE9yaWdpbkVudW0nLCBGaWxlQXR0YWNobWVudE9yaWdpbkVudW0pO1xuICAgICAgICB9KShtb2RlbHMgPSBjb3JlLm1vZGVscyB8fCAoY29yZS5tb2RlbHMgPSB7fSkpO1xuICAgIH0pKGNvcmUgPSBibHVlc2t5LmNvcmUgfHwgKGJsdWVza3kuY29yZSA9IHt9KSk7XG59KShibHVlc2t5IHx8IChibHVlc2t5ID0ge30pKTtcblxudmFyIGJsdWVza3k7XG4oZnVuY3Rpb24gKGJsdWVza3kpIHtcbiAgICB2YXIgY29yZTtcbiAgICAoZnVuY3Rpb24gKGNvcmUpIHtcbiAgICAgICAgdmFyIG1vZGVscztcbiAgICAgICAgKGZ1bmN0aW9uIChtb2RlbHMpIHtcbiAgICAgICAgICAgIC8qKlxuICAgICAgICAgICAgICogVE9ETyBNR0EgOiBleHBvcnQgYW4gaW50ZXJmYWNlIHRvbyA/XG4gICAgICAgICAgICAgKi9cbiAgICAgICAgICAgIHZhciBGaWxlQXR0YWNobWVudCA9IChmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgZnVuY3Rpb24gRmlsZUF0dGFjaG1lbnQoXG4gICAgICAgICAgICAgICAgICAgIC8vc3J2LXNpZGUgcHJvcGVydGllc1xuICAgICAgICAgICAgICAgICAgICBJZCwgRmlsZU5hbWUsIENvbW1lbnQsIFVwbG9hZGVySW5mb3JtYXRpb24sIENyZWF0aW9uRGF0ZSwgRmlsZU9yaWdpbiwgQ2FuQ3VycmVudFVzZXJEb3dubG9hZEZpbGUsIENhbkN1cnJlbnRVc2VyRGVsZXRlRmlsZSwgQ2FuQ3VycmVudFVzZXJFZGl0Q29tbWVudCwgXG4gICAgICAgICAgICAgICAgICAgIC8vY2xpZW50LXNpZGUgcHJvcGVydGllc1xuICAgICAgICAgICAgICAgICAgICBlZGl0Q29tbWVudE1vZGUsIHVwZGF0ZWRDb21tZW50LCB1cGRhdGVkQ29tbWVudEVycm9yTWVzc2FnZSkge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLklkID0gSWQ7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuRmlsZU5hbWUgPSBGaWxlTmFtZTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5Db21tZW50ID0gQ29tbWVudDtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5VcGxvYWRlckluZm9ybWF0aW9uID0gVXBsb2FkZXJJbmZvcm1hdGlvbjtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5DcmVhdGlvbkRhdGUgPSBDcmVhdGlvbkRhdGU7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuRmlsZU9yaWdpbiA9IEZpbGVPcmlnaW47XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuQ2FuQ3VycmVudFVzZXJEb3dubG9hZEZpbGUgPSBDYW5DdXJyZW50VXNlckRvd25sb2FkRmlsZTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5DYW5DdXJyZW50VXNlckRlbGV0ZUZpbGUgPSBDYW5DdXJyZW50VXNlckRlbGV0ZUZpbGU7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuQ2FuQ3VycmVudFVzZXJFZGl0Q29tbWVudCA9IENhbkN1cnJlbnRVc2VyRWRpdENvbW1lbnQ7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuZWRpdENvbW1lbnRNb2RlID0gZWRpdENvbW1lbnRNb2RlO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnVwZGF0ZWRDb21tZW50ID0gdXBkYXRlZENvbW1lbnQ7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMudXBkYXRlZENvbW1lbnRFcnJvck1lc3NhZ2UgPSB1cGRhdGVkQ29tbWVudEVycm9yTWVzc2FnZTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgcmV0dXJuIEZpbGVBdHRhY2htZW50O1xuICAgICAgICAgICAgfSgpKTtcbiAgICAgICAgICAgIG1vZGVscy5GaWxlQXR0YWNobWVudCA9IEZpbGVBdHRhY2htZW50O1xuICAgICAgICAgICAgdmFyIFVzZXJJbmZvcm1hdGlvbiA9IChmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgZnVuY3Rpb24gVXNlckluZm9ybWF0aW9uKEZpcnN0TmFtZSwgTGFzdE5hbWUsIERpc3BsYXlOYW1lLCB1c2VySWRlbnRpZmllciwgRW1haWwsIFBob25lTnVtYmVyKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuRmlyc3ROYW1lID0gRmlyc3ROYW1lO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLkxhc3ROYW1lID0gTGFzdE5hbWU7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuRGlzcGxheU5hbWUgPSBEaXNwbGF5TmFtZTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy51c2VySWRlbnRpZmllciA9IHVzZXJJZGVudGlmaWVyO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLkVtYWlsID0gRW1haWw7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuUGhvbmVOdW1iZXIgPSBQaG9uZU51bWJlcjtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgcmV0dXJuIFVzZXJJbmZvcm1hdGlvbjtcbiAgICAgICAgICAgIH0oKSk7XG4gICAgICAgICAgICBtb2RlbHMuVXNlckluZm9ybWF0aW9uID0gVXNlckluZm9ybWF0aW9uO1xuICAgICAgICB9KShtb2RlbHMgPSBjb3JlLm1vZGVscyB8fCAoY29yZS5tb2RlbHMgPSB7fSkpO1xuICAgIH0pKGNvcmUgPSBibHVlc2t5LmNvcmUgfHwgKGJsdWVza3kuY29yZSA9IHt9KSk7XG59KShibHVlc2t5IHx8IChibHVlc2t5ID0ge30pKTtcblxudmFyIGJsdWVza3k7XG4oZnVuY3Rpb24gKGJsdWVza3kpIHtcbiAgICB2YXIgY29yZTtcbiAgICAoZnVuY3Rpb24gKGNvcmUpIHtcbiAgICAgICAgdmFyIG1vZGVscztcbiAgICAgICAgKGZ1bmN0aW9uIChtb2RlbHMpIHtcbiAgICAgICAgICAgIHZhciBKc29uQm9vbGVhblJlc3BvbnNlID0gKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICBmdW5jdGlvbiBKc29uQm9vbGVhblJlc3BvbnNlKGJvb2xlYW5SZXNwb25zZSkge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmJvb2xlYW5SZXNwb25zZSA9IGJvb2xlYW5SZXNwb25zZTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgcmV0dXJuIEpzb25Cb29sZWFuUmVzcG9uc2U7XG4gICAgICAgICAgICB9KCkpO1xuICAgICAgICAgICAgbW9kZWxzLkpzb25Cb29sZWFuUmVzcG9uc2UgPSBKc29uQm9vbGVhblJlc3BvbnNlO1xuICAgICAgICB9KShtb2RlbHMgPSBjb3JlLm1vZGVscyB8fCAoY29yZS5tb2RlbHMgPSB7fSkpO1xuICAgIH0pKGNvcmUgPSBibHVlc2t5LmNvcmUgfHwgKGJsdWVza3kuY29yZSA9IHt9KSk7XG59KShibHVlc2t5IHx8IChibHVlc2t5ID0ge30pKTtcblxudmFyIGJsdWVza3k7XG4oZnVuY3Rpb24gKGJsdWVza3kpIHtcbiAgICB2YXIgY29yZTtcbiAgICAoZnVuY3Rpb24gKGNvcmUpIHtcbiAgICAgICAgdmFyIGNvbXBvbmVudHM7XG4gICAgICAgIChmdW5jdGlvbiAoY29tcG9uZW50cykge1xuICAgICAgICAgICAgLy9UT0RPIE1HQTogY29udmVydCBib3RoIGNvbnN0YW50cyB0byBzcnYtc2lkZSBwcm92aWRlZCBsaW1pdCB0byBzdGF5IGluIHN5bmMgd2l0aCBDb3JlQVBJIGxpbWl0cyAvIHZhbGlkYXRvcnNcbiAgICAgICAgICAgIHZhciBNQVhfRklMRV9TSVpFID0gMjAwMDAwMDA7IC8vaW4gYnl0ZXMgPSAyMG1iXG4gICAgICAgICAgICB2YXIgTUFYX0NPTU1FTlRfTEVOR1RIID0gMTI4O1xuICAgICAgICAgICAgdmFyIEZpbGVBdHRhY2htZW50Q29tcG9uZW50Q29udHJvbGxlciA9IChmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgLy8jZW5kcmVnaW9uXG4gICAgICAgICAgICAgICAgLy8jcmVnaW9uIGN0b3JcbiAgICAgICAgICAgICAgICAvKiBAbmdJbmplY3QgKi9cbiAgICAgICAgICAgICAgICBmdW5jdGlvbiBGaWxlQXR0YWNobWVudENvbXBvbmVudENvbnRyb2xsZXIoJGxvZywgdG9hc3RlciwgXywgZmlsZUF0dGFjaG1lbnRTZXJ2aWNlLCBmaWxlQXR0YWNobWVudE9yaWdpbkVudW0sIGFwcGxpY2F0aW9uT3JpZ2luRW51bSkge1xuICAgICAgICAgICAgICAgICAgICB2YXIgX3RoaXMgPSB0aGlzO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLiRsb2cgPSAkbG9nO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnRvYXN0ZXIgPSB0b2FzdGVyO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLl8gPSBfO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmZpbGVBdHRhY2htZW50U2VydmljZSA9IGZpbGVBdHRhY2htZW50U2VydmljZTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5maWxlQXR0YWNobWVudE9yaWdpbkVudW0gPSBmaWxlQXR0YWNobWVudE9yaWdpbkVudW07XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuYXBwbGljYXRpb25PcmlnaW5FbnVtID0gYXBwbGljYXRpb25PcmlnaW5FbnVtO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmhhc0N1cnJlbnRVc2VyVXBsb2FkUmlnaHRzID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgICAgIC8qKlxuICAgICAgICAgICAgICAgICAgICAgKiBUT0RPIE1HQTogaW1wcm92ZSBpbmxpbmUtZm9ybSBlcnJvciBoYW5kbGluZyAmIFVJIGZlZWRiYWNrICEgbm90IGR5bmFtaWMgLy8gZmx1aWQgdG8gdXNlXG4gICAgICAgICAgICAgICAgICAgICAqIEBwYXJhbSBmaWxlQXR0YWNobWVudFxuICAgICAgICAgICAgICAgICAgICAgKi9cbiAgICAgICAgICAgICAgICAgICAgdGhpcy5vblVwZGF0ZWRDb21tZW50VmFsaWRhdGVJbnB1dCA9IGZ1bmN0aW9uIChmaWxlQXR0YWNobWVudCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCFmaWxlQXR0YWNobWVudC51cGRhdGVkQ29tbWVudCB8fCBmaWxlQXR0YWNobWVudC51cGRhdGVkQ29tbWVudC5sZW5ndGggPCAxKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZmlsZUF0dGFjaG1lbnQudXBkYXRlZENvbW1lbnRFcnJvck1lc3NhZ2UgPSAnY29tbWVudCBtdXN0IGJlIG5vbi1lbXB0eSc7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSBpZiAoZmlsZUF0dGFjaG1lbnQudXBkYXRlZENvbW1lbnQgJiYgZmlsZUF0dGFjaG1lbnQudXBkYXRlZENvbW1lbnQubGVuZ3RoID49IE1BWF9DT01NRU5UX0xFTkdUSCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZpbGVBdHRhY2htZW50LnVwZGF0ZWRDb21tZW50RXJyb3JNZXNzYWdlID0gXCJjb21tZW50IG11c3QgYmUgPCBcIiArIE1BWF9DT01NRU5UX0xFTkdUSCArIFwiIGNoYXJhY3RlcnNcIjtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmaWxlQXR0YWNobWVudC51cGRhdGVkQ29tbWVudEVycm9yTWVzc2FnZSA9IG51bGw7IC8vcmVzZXQgZXJyb3IgbWVzc2FnZSB0byBmbGFnIGNvbW1lbnQgYXMgdmFsaWRcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICAgICAgLyoqXG4gICAgICAgICAgICAgICAgICAgICAqIEhhbmRsZXIgZGVkaWNhdGVkIHRvIHByZXZlbnQgb24ga2V5cHJlc3M9J2VudGVyJyB0aGUgc3VibWlzc2lvbiBvZiBhIGZvcm0gaWYgdGhpcyBjb21wb25lbnQgaXMgaW5zaWRlIG9uZS5cbiAgICAgICAgICAgICAgICAgICAgICogSW5zdGVhZCwgaXQgcHVzaGVzIHRoZSBuZXcgdmFsdWVcbiAgICAgICAgICAgICAgICAgICAgICovXG4gICAgICAgICAgICAgICAgICAgIHRoaXMub25Db21tZW50SW5wdXRLZXlQcmVzcyA9IGZ1bmN0aW9uICgkZXZlbnQsIGZpbGVBdHRhY2htZW50KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIga2V5Q29kZSA9ICRldmVudC5rZXlDb2RlIHx8ICRldmVudC53aGljaDtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChrZXlDb2RlID09PSAxMykge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vcHJldmVudCBmb3JtIHN1Ym1pc3Npb25cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkZXZlbnQucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvL2NhbGwgXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgX3RoaXMudXBkYXRlRmlsZUF0dGFjaG1lbnRDb21tZW50KGZpbGVBdHRhY2htZW50KTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKCF0aGlzLmVsZW1lbnRJZEJpbmRpbmcpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuJGxvZy5lcnJvcigncGFyYW1ldGVyIHtlbGVtZW50SWRCaW5kaW5nfSBpcyBtYW5kYXRvcnkuJyk7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgaWYgKCF0aGlzLmFwcGxpY2F0aW9uT3JpZ2luRW51bVt0aGlzLm9yaWdpbkJpbmRpbmddKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLiRsb2cuZXJyb3IoJ3BhcmFtZXRlciB7b3JpZ2luQmluZGluZ30gaXMgbWFuZGF0b3J5LicpO1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuaHR0cFByb21pc2VzID0gbmV3IEFycmF5KCk7XG4gICAgICAgICAgICAgICAgICAgIC8vIGdldCBsaXN0IG9mIGF0dGFjaGVkIGZpbGVzIGZvciBjdXJyZW50IGVsZW1lbnRcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5nZXRBdHRhY2hlZEZpbGVzKCk7XG4gICAgICAgICAgICAgICAgICAgIC8vIGdldCBmbGFnIHRvIGtub3cgaWYgY3VycmVudCB1c2VyIGhhcyB1cGxvYWQgcmlnaHRzIGZvciBjdXJyZW50IGl0ZW1cbiAgICAgICAgICAgICAgICAgICAgdGhpcy5nZXRDdXJyZW50VXNlclVwbG9hZFJpZ2h0cygpO1xuICAgICAgICAgICAgICAgICAgICAvLyBnZXQgc3VwcG9ydGVkIG1pbWUgdHlwZXMgZm9yIGZpbGUgdXBsb2FkLCBiYXNlZCBvbiBzcnYgaW5mb1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmdldFN1cHBvcnRlZEV4dGVuc2lvbnMoKTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5uYk9mSXRlbXNQZXJQYWdlID0gMTA7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuZmlsZUludmFsaWRNZXNzYWdlQXJyYXkgPSBuZXcgQXJyYXkoKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgLy8jZW5kcmVnaW9uXG4gICAgICAgICAgICAgICAgLy8jcmVnaW9uIGZpbGUgYXR0YWNobWVudCBtYW5hZ2VtZW50XG4gICAgICAgICAgICAgICAgLy9UT0RPIE1HQTogaGFuZGxlIG11bHRpcGxlIGZpbGVzICYgY2xlYW4gdXAgdmlldyBiaW5kaW5nc1xuICAgICAgICAgICAgICAgIEZpbGVBdHRhY2htZW50Q29tcG9uZW50Q29udHJvbGxlci5wcm90b3R5cGUub25GaWxlU2VsZWN0ZWQgPSBmdW5jdGlvbiAoZmlsZXMsIGZpbGUsIG5ld0ZpbGVzLCBkdXBsaWNhdGVGaWxlcywgaW52YWxpZEZpbGVzLCBldmVudCkge1xuICAgICAgICAgICAgICAgICAgICB2YXIgX3RoaXMgPSB0aGlzO1xuICAgICAgICAgICAgICAgICAgICBpZiAoIWZpbGVzICYmICFmaWxlKVxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmZpbGVJbnZhbGlkTWVzc2FnZUFycmF5ID0gW107IC8vcmVzZXQgZXJyb3IgYXJyYXlcbiAgICAgICAgICAgICAgICAgICAgaWYgKGZpbGVzKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnNlbGVjdGVkRmlsZXMgPSBmaWxlcztcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBpZiAoZmlsZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5zZWxlY3RlZEZpbGUgPSBmaWxlO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGlmIChmaWxlcyAmJiBmaWxlcy5sZW5ndGggPiAxKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmZpbGVJbnZhbGlkTWVzc2FnZUFycmF5LnB1c2goJ0Nhbm5vdCB1cGxvYWQgbXVsdGlwbGUgZmlsZXMgYXQgb25jZS4gUGxlYXNlIHNlbGVjdCBvbmx5IG9uZSBmaWxlLicpO1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIC8vdmFyIGZpbGVFeHRlbnNpb24gPSBmaWxlLm5hbWUuc3Vic3RyKGZpbGUubmFtZS5sYXN0SW5kZXhPZignLicpICsgMSk7XG4gICAgICAgICAgICAgICAgICAgIHZhciBmaWxlRm9ybWF0U3VwcG9ydGVkID0gXyh0aGlzLnN1cHBvcnRlZEV4dGVuc2lvbnMpLmFueShmdW5jdGlvbiAoc3VwcG9ydGVkRXh0ZW5zaW9uKSB7IHJldHVybiBfdGhpcy5zZWxlY3RlZEZpbGUuZ2V0RmlsZUV4dGVuc2lvbigpID09PSBzdXBwb3J0ZWRFeHRlbnNpb24udG9Mb3dlckNhc2UoKTsgfSk7XG4gICAgICAgICAgICAgICAgICAgIC8vdmFyIGZpbGVGb3JtYXRTdXBwb3J0ZWQgPSBmaWxlLnR5cGUgJiYgLy9JZiBmaWxlLnR5cGUgaXMgbnVsbCAvIGVtcHR5LCB0aGF0IG1lYW5zIGN1cnJlbnQgT1MgZG9lc24ndCBrbm93IGFib3V0IHRoZSBmaWxlIGZvcm1hdCA9PiBkZWxlZ2F0ZSB0byBzZXJ2ZXIgdG8gdmFsaWRhdGUgaWYgZm9ybWF0IGlzIHZhbGlkLCB3ZSBjYW4ndCBrbm93IGNsaWVudC1zaWRlLlxuICAgICAgICAgICAgICAgICAgICAvLyAgICBfKHRoaXMuc3VwcG9ydGVkRXh0ZW5zaW9ucykuYW55KChzdXBwb3J0ZWRNaW1lVHlwZSkgPT4gZmlsZS50eXBlID09PSBzdXBwb3J0ZWRNaW1lVHlwZSk7XG4gICAgICAgICAgICAgICAgICAgIGlmICghZmlsZUZvcm1hdFN1cHBvcnRlZClcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuZmlsZUludmFsaWRNZXNzYWdlQXJyYXkucHVzaChcIlVuc3VwcG9ydGVkIGZpbGUgZm9ybWF0OiAnXCIgKyB0aGlzLnNlbGVjdGVkRmlsZS50eXBlICsgXCInIHdpdGggZXh0ZW5zaW9uOiAnXCIgKyB0aGlzLnNlbGVjdGVkRmlsZS5nZXRGaWxlRXh0ZW5zaW9uKCkgKyBcIidcIik7XG4gICAgICAgICAgICAgICAgICAgIGlmICghdGhpcy5zZWxlY3RlZEZpbGUuc2l6ZSlcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuZmlsZUludmFsaWRNZXNzYWdlQXJyYXkucHVzaCgnU2VsZWN0ZWQgZmlsZSBpcyBlbXB0eS4nKTtcbiAgICAgICAgICAgICAgICAgICAgZWxzZSBpZiAodGhpcy5zZWxlY3RlZEZpbGUuc2l6ZSA+PSBNQVhfRklMRV9TSVpFKVxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5maWxlSW52YWxpZE1lc3NhZ2VBcnJheS5wdXNoKFwiU2VsZWN0ZWQgZmlsZSBpcyBiaWdnZXIgKFwiICsgdGhpcy5ieXRlc1RvRm9ybWF0ZWRTdHJpbmcodGhpcy5zZWxlY3RlZEZpbGUuc2l6ZSkgKyBcIikgdGhhbiBhdXRob3JpemVkIGZpbGUgc2l6ZTogXCIgKyB0aGlzLmJ5dGVzVG9Gb3JtYXRlZFN0cmluZyhNQVhfRklMRV9TSVpFKSk7XG4gICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICBGaWxlQXR0YWNobWVudENvbXBvbmVudENvbnRyb2xsZXIucHJvdG90eXBlLmltcG9ydFNlbGVjdGVkRmlsZSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIF90aGlzID0gdGhpcztcbiAgICAgICAgICAgICAgICAgICAgaWYgKCF0aGlzLnNlbGVjdGVkRmlsZSB8fCBfKHRoaXMuZmlsZUludmFsaWRNZXNzYWdlQXJyYXkpLmFueSgpKVxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuOyAvL1RPRE8gTUdBICRsb2dcbiAgICAgICAgICAgICAgICAgICAgdmFyIGh0dHBQcm9taXNlID0gdGhpcy5maWxlQXR0YWNobWVudFNlcnZpY2UuYXR0YWNoRmlsZSh0aGlzLmVsZW1lbnRJZEJpbmRpbmcsIHRoaXMub3JpZ2luQmluZGluZywgdGhpcy5zZWxlY3RlZEZpbGUpLnRoZW4oZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgX3RoaXMudG9hc3Rlci5zdWNjZXNzKFwiRmlsZSAoXCIgKyBfdGhpcy5zZWxlY3RlZEZpbGUubmFtZSArIFwiKSBzdWNjZXNzZnVsbHkgdXBsb2FkZWQuXCIpO1xuICAgICAgICAgICAgICAgICAgICAgICAgX3RoaXMuZ2V0QXR0YWNoZWRGaWxlcygpOyAvL1RPRE8gTUdBIDogaGlnaGxpZ2h0IG5ldyBlbnRyeSA/XG4gICAgICAgICAgICAgICAgICAgIH0pLmZpbmFsbHkoZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgLy9jbGVhbiB1cCBzZWxlY3RlZCBmaWxlXG4gICAgICAgICAgICAgICAgICAgICAgICBfdGhpcy5jbGVhclNlbGVjdGVkRmlsZXMoKTtcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuaHR0cFByb21pc2VzLnB1c2goaHR0cFByb21pc2UpO1xuICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICAgICAgRmlsZUF0dGFjaG1lbnRDb21wb25lbnRDb250cm9sbGVyLnByb3RvdHlwZS5jbGVhclNlbGVjdGVkRmlsZXMgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuc2VsZWN0ZWRGaWxlcyA9IG51bGw7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuc2VsZWN0ZWRGaWxlID0gbnVsbDtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5maWxlSW52YWxpZE1lc3NhZ2VBcnJheSA9IFtdOyAvLyBjbGVhciBlcnJvciBtZXNzYWdlc1xuICAgICAgICAgICAgICAgICAgICAvL3RoaXMuZmlsZVNlbGVjdGVkSXNWYWxpZCA9IHRydWU7XG4gICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICBGaWxlQXR0YWNobWVudENvbXBvbmVudENvbnRyb2xsZXIucHJvdG90eXBlLmRvd25sb2FkQXR0YWNoZWRGaWxlID0gZnVuY3Rpb24gKGZpbGVBdHRhY2htZW50KSB7XG4gICAgICAgICAgICAgICAgICAgIGlmICghZmlsZUF0dGFjaG1lbnQgfHwgIWZpbGVBdHRhY2htZW50LklkKVxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgICAgICB2YXIgaHR0cFByb21pc2UgPSB0aGlzLmZpbGVBdHRhY2htZW50U2VydmljZS5kb3dubG9hZEF0dGFjaGVkRmlsZShmaWxlQXR0YWNobWVudCwgdGhpcy5maWxlQXR0YWNobWVudE9yaWdpbkVudW1bZmlsZUF0dGFjaG1lbnQuRmlsZU9yaWdpbl0pXG4gICAgICAgICAgICAgICAgICAgICAgICAudGhlbihmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAvL1RPRE8gTUdBID8gb3IgbGVhdmUgYXMgaXMuXG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmh0dHBQcm9taXNlcy5wdXNoKGh0dHBQcm9taXNlKTtcbiAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgIEZpbGVBdHRhY2htZW50Q29tcG9uZW50Q29udHJvbGxlci5wcm90b3R5cGUuZGVsZXRlQXR0YWNoZWRGaWxlID0gZnVuY3Rpb24gKGZpbGVBdHRhY2htZW50KSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciBfdGhpcyA9IHRoaXM7XG4gICAgICAgICAgICAgICAgICAgIGlmICghZmlsZUF0dGFjaG1lbnQgfHwgIWZpbGVBdHRhY2htZW50LklkKVxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgICAgICB2YXIgaHR0cFByb21pc2UgPSB0aGlzLmZpbGVBdHRhY2htZW50U2VydmljZS5kZWxldGVBdHRhY2hlZEZpbGUoZmlsZUF0dGFjaG1lbnQuSWQsIHRoaXMuZmlsZUF0dGFjaG1lbnRPcmlnaW5FbnVtW2ZpbGVBdHRhY2htZW50LkZpbGVPcmlnaW5dKVxuICAgICAgICAgICAgICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgX3RoaXMudG9hc3Rlci5zdWNjZXNzKFwiRmlsZSAoXCIgKyBmaWxlQXR0YWNobWVudC5GaWxlTmFtZSArIFwiKSBzdWNjZXNzZnVsbHkgZGVsZXRlZC5cIik7XG4gICAgICAgICAgICAgICAgICAgICAgICBfdGhpcy5nZXRBdHRhY2hlZEZpbGVzKCk7XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmh0dHBQcm9taXNlcy5wdXNoKGh0dHBQcm9taXNlKTtcbiAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgIC8vVE9ETyBNR0E6IGV4dHJhY3QgdG8gc2VydmljZSAvIGV4dGVuc2lvbiBtZXRob2QgP1xuICAgICAgICAgICAgICAgIEZpbGVBdHRhY2htZW50Q29tcG9uZW50Q29udHJvbGxlci5wcm90b3R5cGUuYnl0ZXNUb0Zvcm1hdGVkU3RyaW5nID0gZnVuY3Rpb24gKGJ5dGVzKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmICghYnl0ZXMpXG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gJzAgQnl0ZSc7XG4gICAgICAgICAgICAgICAgICAgIHZhciByZWZlcmVuY2VTY2FsZSA9IDEwMDA7IC8vIG9yIDEwMjQgZm9yIGJpbmFyeSByZWYgdnMuIFNJXG4gICAgICAgICAgICAgICAgICAgIHZhciB1bml0QXJyYXkgPSBbJ0J5dGVzJywgJ0tiJywgJ01iJywgJ0diJywgJ1RiJywgJ1BiJywgJ0ViJywgJ1piJywgJ1liJ107XG4gICAgICAgICAgICAgICAgICAgIC8vIGdldCBsZXZlbCB0byBhZG9wdCBmb3Igc2l6ZSBtdWx0aXBsZSAoYnl0ZXMsIEtCIGV0YykuXG4gICAgICAgICAgICAgICAgICAgIHZhciB1bml0SW5kZXggPSBNYXRoLmZsb29yKE1hdGgubG9nKGJ5dGVzKSAvIE1hdGgubG9nKHJlZmVyZW5jZVNjYWxlKSk7XG4gICAgICAgICAgICAgICAgICAgIC8vIDIgZGVjaW1hbHMsIGFuZCBpZiBvbmx5IE9zIGFmdGVyIHRoZSAnLCcsIHRoZW4gcGFyc2VGbG9hdCB3aWxsIHRyaW0gZW5kaW5nIDBzLlxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gcGFyc2VGbG9hdCgoYnl0ZXMgLyBNYXRoLnBvdyhyZWZlcmVuY2VTY2FsZSwgdW5pdEluZGV4KSkudG9GaXhlZCgyKSkgKyAnICcgKyB1bml0QXJyYXlbdW5pdEluZGV4XTtcbiAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgIC8vI2VuZHJlZ2lvblxuICAgICAgICAgICAgICAgIC8vI3JlZ2lvbiBjb21tZW50IG1hbmFnZW1lbnRcbiAgICAgICAgICAgICAgICBGaWxlQXR0YWNobWVudENvbXBvbmVudENvbnRyb2xsZXIucHJvdG90eXBlLnN3aXRjaFRvRWRpdENvbW1lbnRNb2RlID0gZnVuY3Rpb24gKGZpbGVBdHRhY2htZW50KSB7XG4gICAgICAgICAgICAgICAgICAgIGZpbGVBdHRhY2htZW50LmVkaXRDb21tZW50TW9kZSA9IHRydWU7XG4gICAgICAgICAgICAgICAgICAgIC8vc2V0IHVwZGF0ZWQgY29tbWVudCBmaWVsZCB0byBwcmV2aW91cyBjb21tZW50IHZhbHVlXG4gICAgICAgICAgICAgICAgICAgIGZpbGVBdHRhY2htZW50LnVwZGF0ZWRDb21tZW50ID0gZmlsZUF0dGFjaG1lbnQuQ29tbWVudCB8fCBcIlwiO1xuICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICAgICAgRmlsZUF0dGFjaG1lbnRDb21wb25lbnRDb250cm9sbGVyLnByb3RvdHlwZS51cGRhdGVGaWxlQXR0YWNobWVudENvbW1lbnQgPSBmdW5jdGlvbiAoZmlsZUF0dGFjaG1lbnQpIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIF90aGlzID0gdGhpcztcbiAgICAgICAgICAgICAgICAgICAgaWYgKCFmaWxlQXR0YWNobWVudCB8fCAhZmlsZUF0dGFjaG1lbnQuSWQgfHwgIWZpbGVBdHRhY2htZW50LnVwZGF0ZWRDb21tZW50KVxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgICAgICBpZiAoIXRoaXMub25VcGRhdGVkQ29tbWVudFZhbGlkYXRlSW5wdXQoZmlsZUF0dGFjaG1lbnQpKVxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuOyAvLyBjaGVjayB2YWxpZGF0aW9uIHJ1bGVzIGFyZSBva1xuICAgICAgICAgICAgICAgICAgICB2YXIgaHR0cFByb21pc2UgPSB0aGlzLmZpbGVBdHRhY2htZW50U2VydmljZS5lZGl0RmlsZUF0dGFjaG1lbnRDb21tZW50KGZpbGVBdHRhY2htZW50LklkLCB0aGlzLmZpbGVBdHRhY2htZW50T3JpZ2luRW51bVtmaWxlQXR0YWNobWVudC5GaWxlT3JpZ2luXSwgZmlsZUF0dGFjaG1lbnQudXBkYXRlZENvbW1lbnQpLnRoZW4oZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgX3RoaXMuY2xlYXJFZGl0Q29tbWVudE1vZGUoZmlsZUF0dGFjaG1lbnQpOyAvL1RPRE8gTUdBOiB1c2VsZXNzIGlmIHdlIHJlbG9hZCBhbGwgZGF0YSBmcm9tIHNydlxuICAgICAgICAgICAgICAgICAgICAgICAgLy8gcmV0cmlldmUgdXBkYXRlIGxpc3Qgb2YgZmlsZXMgd2l0aCB1cGRhdGVkIGZpbGUgY29tbWVudCBmcm9tIHNydiA6IFRPRE8gTUdBIGltcHJvdmUgcmVsb2FkIChjb3N0bHkpXG4gICAgICAgICAgICAgICAgICAgICAgICBfdGhpcy5nZXRBdHRhY2hlZEZpbGVzKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBUT0RPIE1HQSA6IGhpZ2hsaWdodCB1cGRhdGVkIGNvbW1lbnQgP1xuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5odHRwUHJvbWlzZXMucHVzaChodHRwUHJvbWlzZSk7XG4gICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICBGaWxlQXR0YWNobWVudENvbXBvbmVudENvbnRyb2xsZXIucHJvdG90eXBlLmNhbmNlbEVkaXRDb21tZW50ID0gZnVuY3Rpb24gKGZpbGVBdHRhY2htZW50KSB7XG4gICAgICAgICAgICAgICAgICAgIGZpbGVBdHRhY2htZW50LmVkaXRDb21tZW50TW9kZSA9IGZhbHNlO1xuICAgICAgICAgICAgICAgICAgICAvL2ZpbGVBdHRhY2htZW50LnVwZGF0ZWRDb21tZW50ID0gXCJcIjsgLy8gVE9ETyBNR0E6IGRlY2lkZSBiZWhhdmlvciA/IGJldHRlciB0byBrZWVwIGxhc3QgZW50cnkgPyBidXQgdGhlbiB3ZSBtdXN0IGFsc28ga2VlcCBlcnJvciBtZXNzYWdlXG4gICAgICAgICAgICAgICAgICAgIC8vZmlsZUF0dGFjaG1lbnQudXBkYXRlZENvbW1lbnRFcnJvck1lc3NhZ2UgPSBudWxsO1xuICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICAgICAgLy8jZW5kcmVnaW9uXG4gICAgICAgICAgICAgICAgLy8jZW5kcmVnaW9uXG4gICAgICAgICAgICAgICAgLy8jcmVnaW9uIHByaXZhdGUgbWV0aG9kc1xuICAgICAgICAgICAgICAgIEZpbGVBdHRhY2htZW50Q29tcG9uZW50Q29udHJvbGxlci5wcm90b3R5cGUuZ2V0QXR0YWNoZWRGaWxlcyA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIF90aGlzID0gdGhpcztcbiAgICAgICAgICAgICAgICAgICAgdmFyIGh0dHBQcm9taXNlID0gdGhpcy5maWxlQXR0YWNobWVudFNlcnZpY2UuZ2V0QXR0YWNoZWRGaWxlcyh0aGlzLmVsZW1lbnRJZEJpbmRpbmcsIHRoaXMub3JpZ2luQmluZGluZykudGhlbihmdW5jdGlvbiAoZmlsZUF0dGFjaG1lbnRMaXN0KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBfdGhpcy5hdHRhY2hlZEZpbGVMaXN0ID0gZmlsZUF0dGFjaG1lbnRMaXN0O1xuICAgICAgICAgICAgICAgICAgICAgICAgX3RoaXMuYXR0YWNoZWRGaWxlTGlzdFNvdXJjZSA9IGZpbGVBdHRhY2htZW50TGlzdDsgLy9UT0RPIE1HQSA6IGR1cGxpY2F0ZSA/IHRvIHByZXZlbnQgdXBkYXRlIHRvIHNvdXJjZSBsaXN0IGlmIGNvbGxlY3Rpb24gbW9kaWZpZWQgP1xuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5odHRwUHJvbWlzZXMucHVzaChodHRwUHJvbWlzZSk7XG4gICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICBGaWxlQXR0YWNobWVudENvbXBvbmVudENvbnRyb2xsZXIucHJvdG90eXBlLmdldFN1cHBvcnRlZEV4dGVuc2lvbnMgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciBfdGhpcyA9IHRoaXM7XG4gICAgICAgICAgICAgICAgICAgIHZhciBodHRwUHJvbWlzZSA9IHRoaXMuZmlsZUF0dGFjaG1lbnRTZXJ2aWNlLmdldFN1cHBvcnRlZEV4dGVuc2lvbnMoKS50aGVuKGZ1bmN0aW9uIChzdXBwb3J0ZWRFeHRlbnNpb25zKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBfdGhpcy5zdXBwb3J0ZWRFeHRlbnNpb25zID0gXyhzdXBwb3J0ZWRFeHRlbnNpb25zKS51bmlxKCk7XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmh0dHBQcm9taXNlcy5wdXNoKGh0dHBQcm9taXNlKTtcbiAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgIEZpbGVBdHRhY2htZW50Q29tcG9uZW50Q29udHJvbGxlci5wcm90b3R5cGUuY2xlYXJFZGl0Q29tbWVudE1vZGUgPSBmdW5jdGlvbiAoZmlsZUF0dGFjaG1lbnQpIHtcbiAgICAgICAgICAgICAgICAgICAgZmlsZUF0dGFjaG1lbnQuZWRpdENvbW1lbnRNb2RlID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgICAgIGZpbGVBdHRhY2htZW50LnVwZGF0ZWRDb21tZW50ID0gbnVsbDtcbiAgICAgICAgICAgICAgICAgICAgZmlsZUF0dGFjaG1lbnQudXBkYXRlZENvbW1lbnRFcnJvck1lc3NhZ2UgPSBudWxsO1xuICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICAgICAgRmlsZUF0dGFjaG1lbnRDb21wb25lbnRDb250cm9sbGVyLnByb3RvdHlwZS5nZXRDdXJyZW50VXNlclVwbG9hZFJpZ2h0cyA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIF90aGlzID0gdGhpcztcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5maWxlQXR0YWNobWVudFNlcnZpY2VcbiAgICAgICAgICAgICAgICAgICAgICAgIC5nZXRDdXJyZW50VXNlclVwbG9hZFJpZ2h0cyh0aGlzLmVsZW1lbnRJZEJpbmRpbmcsIHRoaXMub3JpZ2luQmluZGluZylcbiAgICAgICAgICAgICAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uIChib29sZWFuUmVzcG9uc2UpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIF90aGlzLmhhc0N1cnJlbnRVc2VyVXBsb2FkUmlnaHRzID0gYm9vbGVhblJlc3BvbnNlO1xuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgIHJldHVybiBGaWxlQXR0YWNobWVudENvbXBvbmVudENvbnRyb2xsZXI7XG4gICAgICAgICAgICB9KCkpO1xuICAgICAgICAgICAgY29tcG9uZW50cy5GaWxlQXR0YWNobWVudENvbXBvbmVudENvbnRyb2xsZXIgPSBGaWxlQXR0YWNobWVudENvbXBvbmVudENvbnRyb2xsZXI7XG4gICAgICAgICAgICB2YXIgRmlsZUF0dGFjaG1lbnRDb21wb25lbnQgPSAoZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIGZ1bmN0aW9uIEZpbGVBdHRhY2htZW50Q29tcG9uZW50KCkge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmJpbmRpbmdzID0ge1xuICAgICAgICAgICAgICAgICAgICAgICAgZWxlbWVudElkQmluZGluZzogJz0nLFxuICAgICAgICAgICAgICAgICAgICAgICAgb3JpZ2luQmluZGluZzogJz0nXG4gICAgICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuY29udHJvbGxlciA9IEZpbGVBdHRhY2htZW50Q29tcG9uZW50Q29udHJvbGxlcjtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5jb250cm9sbGVyQXMgPSAndm0nO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnRlbXBsYXRlVXJsID0gJ2NvbXBvbmVudC9maWxlLWF0dGFjaG1lbnQudHBsLmh0bWwnO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICByZXR1cm4gRmlsZUF0dGFjaG1lbnRDb21wb25lbnQ7XG4gICAgICAgICAgICB9KCkpO1xuICAgICAgICAgICAgY29tcG9uZW50cy5GaWxlQXR0YWNobWVudENvbXBvbmVudCA9IEZpbGVBdHRhY2htZW50Q29tcG9uZW50O1xuICAgICAgICAgICAgYW5ndWxhci5tb2R1bGUoJ2JsdWVza3kuY29yZS5jb21wb25lbnRzLmZpbGVBdHRhY2htZW50JywgW1xuICAgICAgICAgICAgICAgICdjZ0J1c3knLFxuICAgICAgICAgICAgICAgICdzbWFydC10YWJsZScsXG4gICAgICAgICAgICAgICAgJ3RvYXN0ZXInLFxuICAgICAgICAgICAgICAgICdmaWxlLWF0dGFjaG1lbnQtY29tcG9uZW50LXRwbCcsXG4gICAgICAgICAgICAgICAgJ2JsdWVza3kuY29yZS5zZXJ2aWNlcy5maWxlQXR0YWNobWVudCcsXG4gICAgICAgICAgICAgICAgJ2JsdWVza3kuY29yZS5tb2RlbHMuZmlsZUF0dGFjaG1lbnRPcmlnaW5FbnVtJyxcbiAgICAgICAgICAgICAgICAnYmx1ZXNreS5jb3JlLm1vZGVscy5hcHBsaWNhdGlvbk9yaWdpbkVudW0nXG4gICAgICAgICAgICBdKVxuICAgICAgICAgICAgICAgIC52YWx1ZSgnY2dCdXN5RGVmYXVsdHMnLCB7IHRlbXBsYXRlVXJsOiAndGVtcGxhdGVzL2FuZ3VsYXItYnVzeS9hbmd1bGFyLWJ1c3ktY3VzdG9tLnRwbC5odG1sJyB9KVxuICAgICAgICAgICAgICAgIC5jb25zdGFudCgnXycsIHdpbmRvd1snXyddKVxuICAgICAgICAgICAgICAgIC5jb25zdGFudCgnbW9tZW50Jywgd2luZG93Wydtb21lbnQnXSlcbiAgICAgICAgICAgICAgICAuY29tcG9uZW50KCdmaWxlQXR0YWNobWVudENvbXBvbmVudCcsIG5ldyBGaWxlQXR0YWNobWVudENvbXBvbmVudCgpKTtcbiAgICAgICAgfSkoY29tcG9uZW50cyA9IGNvcmUuY29tcG9uZW50cyB8fCAoY29yZS5jb21wb25lbnRzID0ge30pKTtcbiAgICB9KShjb3JlID0gYmx1ZXNreS5jb3JlIHx8IChibHVlc2t5LmNvcmUgPSB7fSkpO1xufSkoYmx1ZXNreSB8fCAoYmx1ZXNreSA9IHt9KSk7XG4iXSwic291cmNlUm9vdCI6Ii9zb3VyY2UvIn0=
